<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="All course resources can be found here.
Checklist - Linux Privilege Escalation Checklist - Linux Privilege Escalation
Resources List   Basic Linux Privilege Escalation - https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
  Linux Privilege Escalation - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md
  Checklist - Linux Privilege Escalation (Hacktricks)- https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist
  Sushant 747&amp;rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html
  Initial Enumeration System Enumeration  Enumerating System to find out the system version and running Processes."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://m4lici0u5.com/notes/lin-priv-esc/><title>Notes : Linux Privilege Escalation for OSCP & Beyond :: m4lici0u5</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.4dd687783188f49ad84dad46a495038b4e06a83febd3af9ef767c2f582389730.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Notes : Linux Privilege Escalation for OSCP & Beyond"><meta itemprop=description content="All course resources can be found here.
Checklist - Linux Privilege Escalation Checklist - Linux Privilege Escalation
Resources List   Basic Linux Privilege Escalation - https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
  Linux Privilege Escalation - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md
  Checklist - Linux Privilege Escalation (Hacktricks)- https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist
  Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html
  Initial Enumeration System Enumeration  Enumerating System to find out the system version and running Processes."><meta itemprop=datePublished content="2022-06-26T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-26T00:00:00+00:00"><meta itemprop=wordCount content="1645"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Notes : Linux Privilege Escalation for OSCP & Beyond"><meta name=twitter:description content="All course resources can be found here.
Checklist - Linux Privilege Escalation Checklist - Linux Privilege Escalation
Resources List   Basic Linux Privilege Escalation - https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
  Linux Privilege Escalation - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md
  Checklist - Linux Privilege Escalation (Hacktricks)- https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist
  Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html
  Initial Enumeration System Enumeration  Enumerating System to find out the system version and running Processes."><meta property="og:title" content="Notes : Linux Privilege Escalation for OSCP & Beyond"><meta property="og:description" content="All course resources can be found here.
Checklist - Linux Privilege Escalation Checklist - Linux Privilege Escalation
Resources List   Basic Linux Privilege Escalation - https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
  Linux Privilege Escalation - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md
  Checklist - Linux Privilege Escalation (Hacktricks)- https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist
  Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html
  Initial Enumeration System Enumeration  Enumerating System to find out the system version and running Processes."><meta property="og:type" content="article"><meta property="og:url" content="https://m4lici0u5.com/notes/lin-priv-esc/"><meta property="article:published_time" content="2022-06-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-26T00:00:00+00:00"><meta property="og:site_name" content="m4lici0u5"><meta property="article:published_time" content="2022-06-26 00:00:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>Security_Blog</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://m4lici0u5.com/about>About</a></li><li><a href=https://m4lici0u5.com/htb>HackTheBox</a></li><li><a href=https://m4lici0u5.com/notes>Notes</a></li><li><a href=https://m4lici0u5.com/resume>Resume</a></li><li><a href=https://m4lici0u5.com/talks>Talks</a></li><li><a href=https://m4lici0u5.com/writeups>Writeups</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://m4lici0u5.com/notes/lin-priv-esc/>Notes : Linux Privilege Escalation for OSCP & Beyond</a></h2><div class=post-content><p>All course resources can be found <a href=https://github.com/TCM-Course-Resources/Linux-Privilege-Escalation-Resources>here</a>.</p><h2 id=checklist---linux-privilege-escalation>Checklist - Linux Privilege Escalation</h2><p><a href=https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist>Checklist - Linux Privilege Escalation</a></p><h2 id=resources-list>Resources List</h2><ol><li><p>Basic Linux Privilege Escalation - <a href=https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/>https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a></p></li><li><p>Linux Privilege Escalation - <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md</a></p></li><li><p>Checklist - Linux Privilege Escalation (Hacktricks)- <a href=https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist>https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist</a></p></li><li><p>Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - <a href=https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html>https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html</a></p></li></ol><h1 id=initial-enumeration>Initial Enumeration</h1><h2 id=system-enumeration>System Enumeration</h2><ul><li>Enumerating System to find out the system version and running Processes.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# hostname
~# uname -a
~# cat /proc/version
~# lscpu
~# ps aux | grep root
~# /proc/version
~# /etc/issue
~# pspy <span style=color:#f92672>(</span>https://github.com/DominicBreuker/pspy/releases<span style=color:#f92672>)</span>
</code></pre></div><h2 id=user-enumeration>User Enumeration</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# whoami
~# id
~# sudo -l
~# cat /etc/passwd
</code></pre></div><h2 id=network-enumeration>Network Enumeration</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~#ifonfig
~# ip a
~# ip route 
~# arp -a 
~# ip neigh
~# netstat
</code></pre></div><h2 id=password-hunting>Password Hunting</h2><ul><li><p>Searching for ‚Äòpassword‚Äô word in all the files.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# grep --color<span style=color:#f92672>=</span>auto -rnw <span style=color:#e6db74>&#39;/&#39;</span> -ie <span style=color:#e6db74>&#34;PASSWORD=&#34;</span> --color<span style=color:#f92672>=</span>always 2&gt; /dev/null
</code></pre></div></li><li><p>Searching for files name includes word ‚Äòpassword‚Äô</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# locate passowrd | more
</code></pre></div></li><li><p>Using ‚Äòfind‚Äô command</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# find / -name id_rsa 2&gt; /dev/null
</code></pre></div></li></ul><h3 id=important-find-commands-for-enumeration>Important Find Commands For Enumeration</h3><ul><li><code>find . -name flag1.txt</code>: find the file named ‚Äúflag1.txt‚Äù in the current directory</li><li><code>find /home -name flag1.txt</code>: find the file names ‚Äúflag1.txt‚Äù in the /home directory</li><li><code>find / -type d -name config</code>: find the directory named config under ‚Äú/‚Äù</li><li><code>find / -type f -perm 0777</code>: find files with the 777 permissions (files readable, writable, and executable by all users)</li><li><code>find / -perm a=x</code>: find executable files</li><li><code>find /home -user frank</code>: find all files for user ‚Äúfrank‚Äù under ‚Äú/home‚Äù</li><li><code>find / -mtime 10</code>: find files that were modified in the last 10 days</li><li><code>find / -atime 10</code>: find files that were accessed in the last 10 day</li><li><code>find / -cmin -60</code>: find files changed within the last hour (60 minutes)</li><li><code>find / -amin -60</code>: find files accesses within the last hour (60 minutes)</li><li><code>find / -size 50M</code>: find files with a 50 MB size</li><li><code>find / -writable -type d 2>/dev/null</code> : Find world-writeable folders</li><li><code>find / -perm -222 -type d 2>/dev/null</code>: Find world-writeable folders</li><li><code>find / -perm -o w -type d 2>/dev/null</code>: Find world-writeable folders</li><li><code>find / -perm -u=s -type f 2>/dev/null</code>: Find files with the SUID bit, which allows us to run the file with a higher privilege level than the current user</li><li>This command can also be used with (+) and (-) signs to specify a file that is larger or smaller than the given size.</li></ul><h1 id=exploring-privesc-automated-tools>Exploring PrivEsc Automated Tools</h1><ul><li>LinPeas - <a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS>https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS</a></li><li>Linux Exploit Suggester - <a href=https://github.com/mzet-/linux-exploit-suggester>https://github.com/mzet-/linux-exploit-suggester</a></li><li>LinEnum - <a href=https://github.com/rebootuser/LinEnum>https://github.com/rebootuser/LinEnum</a></li><li>Linux Priv Checker - <a href=https://github.com/sleventyeleven/linuxprivchecker>https://github.com/sleventyeleven/linuxprivchecker</a></li><li><a href=https://github.com/diego-treitos/linux-smart-enumeration>LinSmartEnum</a> - <a href=https://github.com/diego-treitos/linux-smart-enumeration>https://github.com/diego-treitos/linux-smart-enumeration</a></li></ul><h1 id=escalation-path>ESCALATION PATH</h1><h2 id=kernel-exploit>Kernel Exploit</h2><p>Kernel Exploits - <a href=https://github.com/lucyoa/kernel-exploits>https://github.com/lucyoa/kernel-exploits</a></p><h2 id=passwords--file-permissions>Passwords & File Permissions</h2><ul><li><p>Checking for possible passwords in <code>history</code></p></li><li><p>In user‚Äôs directory there are various history files that records the history of various services like <code>.bash_history , .mysql_history, .nano_history</code> etc.</p></li><li><p>We can look all of these history files for various passwords using <code>cat *.history | less</code></p></li><li><p>Check for config files as well.</p></li><li><p>Looting For Passwords (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#looting-for-passwords>PayloadAllThing</a>)</p></li><li><p>Running Linpeas , LinEnum may also work and provide a lot more information.</p></li><li><p>Playing around with <code>/etc/shadow</code> or <code>/etc/passwd</code> files.</p></li><li><p>Finding SSH Private Keys</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# find / -name authorized_keys 2&gt;/dev/null
~# find / -name id_rsa 2&gt; /dev/null
</code></pre></div></li></ul><h2 id=sudo-exploitation>Sudo Exploitation</h2><ul><li><code>sudo -l</code> to find the binaries allowed to run as root without password, then use <a href=https://gtfobins.github.io/>GTFOBins</a> to exploit those and get the Root shell.</li><li>Abusing the Binaries which are not available on GTFOBins, By abusing there intended functionality.</li><li>If you find inside the output of <strong><code>sudo -l</code></strong>
the sentence: <em><strong><code>env_keep+=LD_PRELOAD</code></strong></em>
and you can call some command with sudo, you can escalate privileges.</li><li>Use <a href=https://github.com/mzet-/linux-exploit-suggester>Linux Exploit Suggester</a>, to find some possible Sudo version exploits or Recent Sudo CVE‚Äôs.</li></ul><h2 id=escalation-path--suid>Escalation Path : SUID</h2><ul><li><p>Read more about SUID <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#suid>here</a>.</p></li><li><p>Find SUID binaries</p><p><code>find / -perm -4000 -type f -exec ls -la {} 2>/dev/null \;
find / -uid 0 -perm -4000 -type f 2>/dev/null</code></p><p>To Find SUID or SGID bits set Binary Files</p><p><code>find / -type -f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null</code></p></li><li><p>GTFO Bins to Exploit SUID <a href=https://gtfobins.github.io/#+suid>https://gtfobins.github.io/#+suid</a></p></li></ul><h2 id=escalation-path--other-suid-escalation-shared-object-injection--binary-symlinks-environmental-variables>Escalation Path : Other SUID Escalation (Shared Object Injection , Binary Symlinks, Environmental Variables</h2><h3 id=escalation-with-shared-object-injectionhttpsgithubcomswisskyrepopayloadsallthethingsblobmastermethodology20and20resourceslinux20-20privilege20escalationmdshared-library>Escalation with <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#shared-library>Shared Object Injection</a></h3><ul><li>We can use <code>strace</code>, <code>ltrace</code> , <code>ldd</code> , <code>readelf</code> to determine shared object files in a binary and also the RPATH.<ul><li>Running <code>strings</code> against a file :<ul><li><code>strings /path/to/file</code></li></ul></li><li>Running <code>strace</code> against a command :<ul><li><code>strace -v -f -e execve &lt;command> 2>&1 | grep exec</code></li></ul></li><li>Running <code>ltrace</code> against a command :<ul><li><code>ltrace &lt;command></code></li></ul></li></ul></li></ul><h3 id=escalation-via-binary-symlinks--nginx-exploit-cve-2016-1247httpslegalhackerscomadvisoriesnginx-exploit-deb-root-privesc-cve-2016-1247html>Escalation via <a href=https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html>Binary Symlinks ( Nginx Exploit CVE-2016-1247)</a></h3><ul><li>Read More Here (<a href=https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html>https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html</a>)</li></ul><h3 id=escalation-via-environmental-variables>Escalation Via Environmental Variables</h3><ul><li><code>env</code> to list out all the environment variables.</li><li>Find Binaries with SUID enabled <code>find / -type -perm 04000 -ls 2>/dev/null</code></li><li><code>strings</code> on a binary , which is allowed to run as root (SUID must be enabled)</li><li>if a system binary is running Like <code>service apache2 start</code>, Here <code>service</code> binary is being load using the PATH varibles.</li><li>We can Define the PATH and add custom path to a malicious <code>service</code> binary, Like <code>export PATH=/tmp:$PATH</code></li><li>Malicious C code <code>int main() { setgid(0); setuid(0); system("/bin/bash"); return 0;}</code> , This code will run a shell as root.</li></ul><ul><li>What if Binary with SUID if using whole path to call the <code>service</code> Binary Like <code>/usr/sbin/service apache2 start</code> (With absolute path name)<ul><li><p>In Some shells (notably Bash &lt;4.2-048) it is possible to define a user function with an absolute path name.</p></li><li><p>These functions can be exported So that subprocesses have access to them , and the functions can take precedence over the actual executable bein called.</p></li><li><p>In that case we will use a malicious function and export the function, Before that make sure the bash version is &lt;4.2-048 using <code>/bin/sh --version</code></p></li><li><p><code>function /usr/sbin/service() { cp /bin/bash /tmp && chmod +s /tmp/bash && /tmp/bash -p; }</code> call this function and export it.</p><ul><li><code>export -f /usr/sbin/service</code></li></ul><p><img src=/notes/Untitled.png alt=Untitled></p></li><li><p>To learn More about this method refer here (<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation#suid-binary-with-command-path>https://book.hacktricks.xyz/linux-hardening/privilege-escalation#suid-binary-with-command-path</a>)</p></li></ul></li></ul><ul><li>Bash has a debugging mode which can be enabled with the -x command line option, or by modifying the <strong>SHELLOPTS environmental variable to include xtrace.</strong></li><li>By default, SHELLOPTS is read only, however the env command allows SHELLOPTS to be set.</li><li>When in debugging mode, Bash uses the environmental variable PS4 to display an extra prompt for debug statements. This variable can include an embedded command, which will execute every time it is shown.</li><li>If a SUID file runs another program via Bash (e.g. by using system() ) these environmental variables can be inherited.</li><li>If an SUID file is being executed, this command will execute with the privilege of the file owner.</li><li>In Bash versions 4.4 and above, the PS4 environment variable is not inherited by shells running as root.<ul><li><code>env -i SHELLOPTS=xtrace PS4=‚Äô$(whoami)‚Äô /usr/local/bin/suid-env2</code></li></ul></li></ul><h2 id=escalation-path--capabilities>Escalation Path : Capabilities</h2><ul><li><p>List out the capabilities <code>getcap -r / 2>/dev/null</code></p></li><li><p>Read More About Linux Capabilities and Exploiting Methods (<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#why-capabilities>https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#why-capabilities</a>)</p></li><li><p>Linux Privilege Escalation using Capabilities - <a href=https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/>https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/</a></p></li><li><p>SUID vs Capabilities - <a href=https://mn3m.info/posts/suid-vs-capabilities/>https://mn3m.info/posts/suid-vs-capabilities/</a></p></li><li><p>Linux Capabilities Privilege Escalation - <a href=https://medium.com/@int0x33/day-44-linux-capabilities-privilege-escalation-via-openssl-with-selinux-enabled-and-enforced-74d2bec02099>https://medium.com/@int0x33/day-44-linux-capabilities-privilege-escalation-via-openssl-with-selinux-enabled-and-enforced-74d2bec02099</a></p></li></ul><h2 id=escalation-path--scheduled-tasks>Escalation Path : Scheduled Tasks</h2><p>[<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs>https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs</a>]</p><ul><li><p>Escalation via Cron Paths ( <a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation#cron-path>https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs</a>)</p></li><li><p>Escalation via Wildcard in Cron (Wildcard Injection</p><ul><li>Read More (<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation#cron-using-a-script-with-a-wildcard-wildcard-injection>https://book.hacktricks.xyz/linux-hardening/privilege-escalation#cron-using-a-script-with-a-wildcard-wildcard-injection</a>)</li><li>If a script being executed by root has a ‚Äú*****
‚Äù inside a command, you could exploit this to make unexpected things.</li><li>NOTE: If the wildcard is preceded of a path like <code>/some/path/*</code> or even <code>./*</code> then its not vulnerable to wildcard injection.</li><li><code>rsync -a *.sh rsync://host.back/src/rbd</code> You can create a file called <code>"-e sh [myscript.sh](http://myscript.sh/)"</code> so the script will execute our script. This can be done with <code>touch '-e sh myscript.sh'</code> at the same location of myscript.sh file.</li><li>Read More About these Wildcard Spare Tricks (<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation/wildcards-spare-tricks>https://book.hacktricks.xyz/linux-hardening/privilege-escalation/wildcards-spare-tricks</a>)</li></ul></li><li><p>Escalation via Cron File Overwrites</p><ul><li>If you can modify a cron script executed by root, you can get a shell very easily.<ul><li>Read More (<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation#cron-script-overwriting-and-symlink>https://book.hacktricks.xyz/linux-hardening/privilege-escalation#cron-script-overwriting-and-symlink</a>)q</li></ul></li></ul></li><li><p>Frequent Cron Jobs / Invisible Cron Jobs</p><ul><li><p><strong>monitor every 0.1s during 1 minute</strong>, <strong>sort by less executed commands</strong> and deleting the commands that have being executed all the time, you can do:</p><p><code>for i in $(seq 1 610); do ps -e --format cmd >> /tmp/monprocs.tmp; sleep 0.1; done; sort /tmp/monprocs.tmp | uniq -c | grep -v "\[" | sed '/^.\{200\}./d' | sort | grep -E -v "\s*[6-9][0-9][0-9]|\s*[0-9][0-9][0-9][0-9]"; rm /tmp/monprocs.tmp;</code></p></li><li><p>You can also use <code>pspy</code> , this will monitor and list every process that start.(<a href=https://github.com/DominicBreuker/pspy/releases>https://github.com/DominicBreuker/pspy/releases</a>)</p></li><li><p>It&rsquo;s possible to create a cronjob <strong>putting a carriage return after a comment</strong> (without new line character), and the cron job will work. Example (note the carriege return char): <code>#This is a comment inside a cron config file\r* * * * * echo "Surprise!"</code></p></li></ul></li></ul><h2 id=escalation-path--nfs-root-squashing>Escalation Path : NFS Root Squashing</h2><ul><li><p>Read More (<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation/nfs-no_root_squash-misconfiguration-pe>https://book.hacktricks.xyz/linux-hardening/privilege-escalation/nfs-no_root_squash-misconfiguration-pe</a>)</p></li><li><p>To understand it better watch (<a href="https://www.youtube.com/watch?v=vnB7aDzcScg">https://www.youtube.com/watch?v=vnB7aDzcScg</a>)</p></li><li><p>Root squashing is how NFS prevent an obvious privilege Escalation. If the remote user is (or claims to be_ root (uid=0), NFS will instead ‚Äòsquash‚Äô the user and treat them as if they are the ‚Äònobody‚Äô user, in the ‚Äònogroup‚Äô group. While this behaviour is default, It can be disabled.</p></li><li><p><code>no_root_squash</code> is an NFS configuration option which turns root squashing off. When included in a writable share configuration, a remote user who identifies as ‚Äòroot‚Äô can create files on the NFS share as local root user.</p><ul><li>To check the NFS config in target machine<ul><li><code>cat /etc/exports</code></li></ul></li><li>Show the NFS Server‚Äôs export list:<ul><li><code>showmount -e &lt;target></code></li></ul></li><li>Similar nmap Script<ul><li><code>nmap -sV --script=nfs-showmount &lt;target></code></li></ul></li><li>Mount an NFS Share<ul><li><code>mount -o rw,vers=2 &lt;target>:&lt;share> &lt;local_directory></code></li></ul></li></ul></li></ul><h2 id=escalation-path--docker-breakout>Escalation Path : Docker Breakout</h2><ul><li>Read More (<a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout/docker-breakout-privilege-escalation>https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout/docker-breakout-privilege-escalation</a>)</li><li>Some Automatic Docker Enumeration & Escaping Tools<ul><li><a href=https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS>Linpeas</a> : It can also <strong>enumerate containers</strong></li><li><a href=https://github.com/cdk-team/CDK#installationdelivery>CDK</a> : This tool is pretty <strong>useful to enumerate the container you are into even try to escape automatically</strong></li><li><a href=https://github.com/genuinetools/amicontained>Amicontained</a> : Useful tool to get the privileges the container has in order to find ways to escape from it</li><li><a href=https://github.com/stealthcopter/deepce>Deepce</a> : Tool to enumerate and escape from containers</li><li><a href=https://github.com/anchore/grype>Grype</a> : Get the CVEs contained in the software installed in the image</li></ul></li><li>Using GTFOBins (<a href=https://gtfobins.github.io/gtfobins/docker/>https://gtfobins.github.io/gtfobins/docker/</a>)</li></ul><h1 id=practice-linux-privilege-escalation-thm>Practice Linux Privilege Escalation (THM)</h1><h3 id=tryhackme-rooms-practice>TryHackMe Rooms (Practice)</h3><ul><li><a href=https://tryhackme.com/room/linprivesc>Linprivesc</a></li><li>SimpleCTF Room</li><li>CMesS Room</li><li>UltraTech Room</li></ul><h3 id=tryhackme-rooms-challenges>TryHackMe Rooms (Challenges)</h3><ul><li>Lazy Admin</li><li>Anonymous</li><li>Tomghost</li><li>ConvertMyVideo</li><li>Brainpan1</li></ul></div></article><hr><div class=post-info></div></main></div><footer class=footer><div class=footer__inner></div><div class=footer__inner><div class=footer__content><span></span><span>Made with üíõ by <a href=/>An0nud4y</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js integrity="sha512-3HFukJLJggt3+W2ilNASCu6xibW86pdSMJ6+on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script></body></html>